"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4202],{90723:function(t,e,n){function r(t,e="utf8"){return new TextDecoder(e).decode(t)}n.d(e,{Jx:function(){return T}});let s=new TextEncoder,i=(()=>{let t=new Uint8Array(4);return!((new Uint32Array(t.buffer)[0]=1)&t[0])})(),a={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class o{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(t=8192,e={}){let n=!1;"number"==typeof t?t=new ArrayBuffer(t):(n=!0,this.lastWrittenByte=t.byteLength);let r=e.offset?e.offset>>>0:0,s=t.byteLength-r,i=r;(ArrayBuffer.isView(t)||t instanceof o)&&(t.byteLength!==t.buffer.byteLength&&(i=t.byteOffset+r),t=t.buffer),n?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=t,this.length=s,this.byteLength=s,this.byteOffset=i,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,i,s),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){let t=this._marks.pop();if(void 0===t)throw Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){let e=2*(this.offset+t),n=new Uint8Array(e);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=e,this.byteLength=e,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){let n=a[e].BYTES_PER_ELEMENT*t,r=this.byteOffset+this.offset,s=this.buffer.slice(r,r+n);if(this.littleEndian===i&&"uint8"!==e&&"int8"!==e){let t=new Uint8Array(this.buffer.slice(r,r+n));t.reverse();let s=new a[e](t.buffer);return this.offset+=n,s.reverse(),s}let o=new a[e](s);return this.offset+=n,o}readInt16(){let t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){let t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){let t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){let t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){let t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){let t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){let t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){let t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let n=0;n<t;n++)e+=this.readChar();return e}readUtf8(t=1){return r(this.readBytes(t))}decodeText(t=1,e="utf8"){return r(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(s.encode(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}var l,h,c=n(93425);let u=[];for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;u[t]=e}function d(t,e,n){let r=t.readUint32(),s=(4294967295^function(t,e,n){let r=4294967295;for(let t=0;t<n;t++)r=u[(r^e[t])&255]^r>>>8;return r}(0,new Uint8Array(t.buffer,t.byteOffset+t.offset-e-4,e),e))>>>0;if(s!==r)throw Error(`CRC mismatch for chunk ${n}. Expected ${r}, found ${s}`)}function f(t,e,n){for(let r=0;r<n;r++)e[r]=t[r]}function p(t,e,n,r){let s=0;for(;s<r;s++)e[s]=t[s];for(;s<n;s++)e[s]=t[s]+e[s-r]&255}function g(t,e,n,r){let s=0;if(0===n.length)for(;s<r;s++)e[s]=t[s];else for(;s<r;s++)e[s]=t[s]+n[s]&255}function m(t,e,n,r,s){let i=0;if(0===n.length){for(;i<s;i++)e[i]=t[i];for(;i<r;i++)e[i]=t[i]+(e[i-s]>>1)&255}else{for(;i<s;i++)e[i]=t[i]+(n[i]>>1)&255;for(;i<r;i++)e[i]=t[i]+(e[i-s]+n[i]>>1)&255}}function y(t,e,n,r,s){let i=0;if(0===n.length){for(;i<s;i++)e[i]=t[i];for(;i<r;i++)e[i]=t[i]+e[i-s]&255}else{for(;i<s;i++)e[i]=t[i]+n[i]&255;for(;i<r;i++)e[i]=t[i]+function(t,e,n){let r=t+e-n,s=Math.abs(r-t),i=Math.abs(r-e),a=Math.abs(r-n);return s<=i&&s<=a?t:i<=a?e:n}(e[i-s],n[i],n[i-s])&255}}let w=255===new Uint8Array(new Uint16Array([255]).buffer)[0],_=255===new Uint8Array(new Uint16Array([255]).buffer)[0],b=new Uint8Array(0);function v(t){let e,n;let{data:r,width:s,height:i,channels:a,depth:o}=t,l=Math.ceil(o/8)*a,h=Math.ceil(o/8*a*s),c=new Uint8Array(i*h),u=b,d=0;for(let t=0;t<i;t++){switch(e=r.subarray(d+1,d+1+h),n=c.subarray(t*h,(t+1)*h),r[d]){case 0:f(e,n,h);break;case 1:p(e,n,h,l);break;case 2:g(e,n,u,h);break;case 3:m(e,n,u,h,l);break;case 4:y(e,n,u,h,l);break;default:throw Error(`Unsupported filter: ${r[d]}`)}u=n,d+=h+1}if(16!==o)return c;{let t=new Uint16Array(c.buffer);if(_)for(let e=0;e<t.length;e++){var w;t[e]=(255&(w=t[e]))<<8|w>>8&255}return t}}let x=Uint8Array.of(137,80,78,71,13,10,26,10);function S(t){if(!function(t){if(t.length<x.length)return!1;for(let e=0;e<x.length;e++)if(t[e]!==x[e])return!1;return!0}(t.readBytes(x.length)))throw Error("wrong PNG signature")}let A=new TextDecoder("latin1"),k=/^[\u0000-\u00FF]*$/;function O(t){for(t.mark();0!==t.readByte(););let e=t.offset;t.reset();let n=A.decode(t.readBytes(e-t.offset-1));return t.skip(1),!function(t){if(function(t){if(!k.test(t))throw Error("invalid latin1 text")}(t),0===t.length||t.length>79)throw Error("keyword length must be between 1 and 79")}(n),n}let E={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},C={UNKNOWN:-1,DEFLATE:0},P={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},I={NONE:0,BACKGROUND:1,PREVIOUS:2},$={SOURCE:0,OVER:1};class R extends o{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(t,e={}){super(t);let{checkCrc:n=!1}=e;this._checkCrc=n,this._inflator=new c.T_,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=C.UNKNOWN,this._filterMethod=-1,this._interlaceMethod=P.UNKNOWN,this._colorType=E.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(S(this);!this._end;){let t=this.readUint32(),e=this.readChars(4);this.decodeChunk(t,e)}return this.decodeImage(),this._png}decodeApng(){for(S(this);!this._end;){let t=this.readUint32(),e=this.readChars(4);this.decodeApngChunk(t,e)}return this.decodeApngImage(),this._apng}decodeChunk(t,e){let n=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(t);break;case"IDAT":this.decodeIDAT(t);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(t);break;case"iCCP":this.decodeiCCP(t);break;case"tEXt":!function(t,e,n){var r;let s=O(e);t[s]=(r=n-s.length-1,A.decode(e.readBytes(r)))}(this._png.text,this,t);break;case"pHYs":this.decodepHYs();break;default:this.skip(t)}if(this.offset-n!==t)throw Error(`Length mismatch while decoding chunk ${e}`);this._checkCrc?d(this,t+4,e):this.skip(4)}decodeApngChunk(t,e){let n=this.offset;switch("fdAT"!==e&&"IDAT"!==e&&this._writingDataChunks&&this.pushDataToFrame(),e){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(t);break;default:this.decodeChunk(t,e),this.offset=n+t}if(this.offset-n!==t)throw Error(`Length mismatch while decoding chunk ${e}`);this._checkCrc?d(this,t+4,e):this.skip(4)}decodeIHDR(){let t;let e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=function(t){if(1!==t&&2!==t&&4!==t&&8!==t&&16!==t)throw Error(`invalid bit depth: ${t}`);return t}(this.readUint8());let n=this.readUint8();switch(this._colorType=n,n){case E.GREYSCALE:t=1;break;case E.TRUECOLOUR:t=3;break;case E.INDEXED_COLOUR:t=1;break;case E.GREYSCALE_ALPHA:t=2;break;case E.TRUECOLOUR_ALPHA:t=4;break;case E.UNKNOWN:default:throw Error(`Unknown color type: ${n}`)}if(this._png.channels=t,this._compressionMethod=this.readUint8(),this._compressionMethod!==C.DEFLATE)throw Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){let t={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(t)}decodePLTE(t){if(t%3!=0)throw RangeError(`PLTE field length must be a multiple of 3. Got ${t}`);let e=t/3;this._hasPalette=!0;let n=[];this._palette=n;for(let t=0;t<e;t++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(t){this._writingDataChunks=!0;let e=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,e,t)),this._inflator.err)throw Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(t)}decodeFDAT(t){this._writingDataChunks=!0;let e=t,n=this.offset+this.byteOffset;if(n+=4,e-=4,this._inflator.push(new Uint8Array(this.buffer,n,e)),this._inflator.err)throw Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(t)}decodetRNS(t){switch(this._colorType){case E.GREYSCALE:case E.TRUECOLOUR:if(t%2!=0)throw RangeError(`tRNS chunk length must be a multiple of 2. Got ${t}`);if(t/2>this._png.width*this._png.height)throw Error(`tRNS chunk contains more alpha values than there are pixels (${t/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(t/2);for(let e=0;e<t/2;e++)this._transparency[e]=this.readUint16();break;case E.INDEXED_COLOUR:{if(t>this._palette.length)throw Error(`tRNS chunk contains more alpha values than there are palette colors (${t} vs ${this._palette.length})`);let e=0;for(;e<t;e++){let t=this.readByte();this._palette[e].push(t)}for(;e<this._palette.length;e++)this._palette[e].push(255);break}case E.UNKNOWN:case E.GREYSCALE_ALPHA:case E.TRUECOLOUR_ALPHA:default:throw Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(t){let e=O(this),n=this.readUint8();if(n!==C.DEFLATE)throw Error(`Unsupported iCCP compression method: ${n}`);let r=this.readBytes(t-e.length-2);this._png.iccEmbeddedProfile={name:e,profile:(0,c.rr)(r)}}decodepHYs(){let t=this.readUint32(),e=this.readUint32(),n=this.readByte();this._png.resolution={x:t,y:e,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let t=0;t<this._numberOfFrames;t++){let e={sequenceNumber:this._frames[t].sequenceNumber,delayNumber:this._frames[t].delayNumber,delayDenominator:this._frames[t].delayDenominator,data:8===this._apng.depth?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(t);if(n){if(n.data=v({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),0===t||0===n.xOffset&&0===n.yOffset&&n.width===this._png.width&&n.height===this._png.height)e.data=n.data;else{let r=this._apng.frames.at(t-1);this.disposeFrame(n,r,e),this.addFrameDataToCanvas(e,n)}this._apng.frames.push(e)}}return this._apng}disposeFrame(t,e,n){switch(t.disposeOp){case I.NONE:break;case I.BACKGROUND:for(let e=0;e<this._png.height;e++)for(let r=0;r<this._png.width;r++){let s=(e*t.width+r)*this._png.channels;for(let t=0;t<this._png.channels;t++)n.data[s+t]=0}break;case I.PREVIOUS:n.data.set(e.data);break;default:throw Error("Unknown disposeOp")}}addFrameDataToCanvas(t,e){let n=1<<this._png.depth,r=(t,n)=>({index:((t+e.yOffset)*this._png.width+e.xOffset+n)*this._png.channels,frameIndex:(t*e.width+n)*this._png.channels});switch(e.blendOp){case $.SOURCE:for(let n=0;n<e.height;n++)for(let s=0;s<e.width;s++){let{index:i,frameIndex:a}=r(n,s);for(let n=0;n<this._png.channels;n++)t.data[i+n]=e.data[a+n]}break;case $.OVER:for(let s=0;s<e.height;s++)for(let i=0;i<e.width;i++){let{index:a,frameIndex:o}=r(s,i);for(let r=0;r<this._png.channels;r++){let s=e.data[o+this._png.channels-1]/n,i=Math.floor(s*(r%(this._png.channels-1)==0?1:e.data[o+r])+(1-s)*t.data[a+r]);t.data[a+r]+=i}}break;default:throw Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw Error(`Error while decompressing the data: ${this._inflator.err}`);let t=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(0!==this._filterMethod)throw Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===P.NO_INTERLACE)this._png.data=v({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===P.ADAM7)this._png.data=function(t){let{data:e,width:n,height:r,channels:s,depth:i}=t,a=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(i/8)*s,l=new Uint8Array(r*n*o),h=0;for(let t=0;t<7;t++){let s=a[t],i=Math.ceil((n-s.x)/s.xStep),c=Math.ceil((r-s.y)/s.yStep);if(i<=0||c<=0)continue;let u=i*o,d=new Uint8Array(u);for(let t=0;t<c;t++){let a=e[h++],c=e.subarray(h,h+u);h+=u;let w=new Uint8Array(u);!function(t,e,n,r,s,i){switch(t){case 0:f(e,n,s);break;case 1:p(e,n,s,i);break;case 2:g(e,n,r,s);break;case 3:m(e,n,r,s,i);break;case 4:y(e,n,r,s,i);break;default:throw Error(`Unsupported filter: ${t}`)}}(a,c,w,d,u,o),d.set(w);for(let e=0;e<i;e++){let i=s.x+e*s.xStep,a=s.y+t*s.yStep;if(!(i>=n)&&!(a>=r))for(let t=0;t<o;t++)l[(a*n+i)*o+t]=w[e*o+t]}}}if(16!==i)return l;{let t=new Uint16Array(l.buffer);if(w)for(let e=0;e<t.length;e++){var c;t[e]=(255&(c=t[e]))<<8|c>>8&255}return t}}({data:t,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){let t=this._inflator.result,e=this._frames.at(-1);e?e.data=t:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:I.NONE,blendOp:$.SOURCE,data:t}),this._inflator=new c.T_,this._writingDataChunks=!1}}function T(t,e){return new R(t,e).decode()}(l=h||(h={}))[l.UNKNOWN=0]="UNKNOWN",l[l.METRE=1]="METRE"},6466:function(t,e,n){n.d(e,{iZ:function(){return X}});var r={},s=Uint8Array,i=Uint16Array,a=Int32Array,o=new s([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l=new s([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),h=new s([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=function(t,e){for(var n=new i(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];for(var s=new a(n[30]),r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)s[o]=o-n[r]<<5|r;return{b:n,r:s}},u=c(o,2),d=u.b,f=u.r;d[28]=258,f[258]=28;for(var p=c(l,0),g=p.b,m=p.r,y=new i(32768),w=0;w<32768;++w){var _=(43690&w)>>1|(21845&w)<<1;_=(61680&(_=(52428&_)>>2|(13107&_)<<2))>>4|(3855&_)<<4,y[w]=((65280&_)>>8|(255&_)<<8)>>1}for(var b=function(t,e,n){for(var r,s=t.length,a=0,o=new i(e);a<s;++a)t[a]&&++o[t[a]-1];var l=new i(e);for(a=1;a<e;++a)l[a]=l[a-1]+o[a-1]<<1;if(n){r=new i(1<<e);var h=15-e;for(a=0;a<s;++a)if(t[a])for(var c=a<<4|t[a],u=e-t[a],d=l[t[a]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)r[y[d]>>h]=c}else for(a=0,r=new i(s);a<s;++a)t[a]&&(r[a]=y[l[t[a]-1]++]>>15-t[a]);return r},v=new s(288),w=0;w<144;++w)v[w]=8;for(var w=144;w<256;++w)v[w]=9;for(var w=256;w<280;++w)v[w]=7;for(var w=280;w<288;++w)v[w]=8;for(var x=new s(32),w=0;w<32;++w)x[w]=5;var S=b(v,9,0),A=b(x,5,0),k=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},O=function(t,e,n){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&n},E=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},C=function(t){return(t+7)/8|0},P=function(t,e,n){return(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length),new s(t.subarray(e,n))},I=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$=function(t,e,n){var r=Error(e||I[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,$),!n)throw r;return r},R=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},T=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},N=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var a=n.length,o=n.slice();if(!a)return{t:j,l:0};if(1==a){var l=new s(n[0].s+1);return l[n[0].s]=1,{t:l,l:1}}n.sort(function(t,e){return t.f-e.f}),n.push({s:-1,f:25001});var h=n[0],c=n[1],u=0,d=1,f=2;for(n[0]={s:-1,f:h.f+c.f,l:h,r:c};d!=a-1;)h=n[n[u].f<n[f].f?u++:f++],c=n[u!=d&&n[u].f<n[f].f?u++:f++],n[d++]={s:-1,f:h.f+c.f,l:h,r:c};for(var p=o[0].s,r=1;r<a;++r)o[r].s>p&&(p=o[r].s);var g=new i(p+1),m=D(n[d-1],g,0);if(m>e){var r=0,y=0,w=m-e,_=1<<w;for(o.sort(function(t,e){return g[e.s]-g[t.s]||t.f-e.f});r<a;++r){var b=o[r].s;if(g[b]>e)y+=_-(1<<m-g[b]),g[b]=e;else break}for(y>>=w;y>0;){var v=o[r].s;g[v]<e?y-=1<<e-g[v]++-1:++r}for(;r>=0&&y;--r){var x=o[r].s;g[x]==e&&(--g[x],++y)}m=e}return{t:new s(g),l:m}},D=function(t,e,n){return -1==t.s?Math.max(D(t.l,e,n+1),D(t.r,e,n+1)):e[t.s]=n},W=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new i(++e),r=0,s=t[0],a=1,o=function(t){n[r++]=t},l=1;l<=e;++l)if(t[l]==s&&l!=e)++a;else{if(!s&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(s),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(s);a=1,s=t[l]}return{c:n.subarray(0,r),n:e}},M=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},U=function(t,e,n){var r=n.length,s=C(e+2);t[s]=255&r,t[s+1]=r>>8,t[s+2]=255^t[s],t[s+3]=255^t[s+1];for(var i=0;i<r;++i)t[s+i+4]=n[i];return(s+4+r)*8},L=function(t,e,n,r,s,a,c,u,d,f,p){R(e,p++,n),++s[256];for(var g,m,y,w,_=N(s,15),k=_.t,O=_.l,E=N(a,15),C=E.t,P=E.l,I=W(k),$=I.c,D=I.n,L=W(C),F=L.c,j=L.n,B=new i(19),H=0;H<$.length;++H)++B[31&$[H]];for(var H=0;H<F.length;++H)++B[31&F[H]];for(var q=N(B,7),z=q.t,K=q.l,X=19;X>4&&!z[h[X-1]];--X);var J=f+5<<3,V=M(s,v)+M(a,x)+c,Y=M(s,k)+M(a,C)+c+14+3*X+M(B,z)+2*B[16]+3*B[17]+7*B[18];if(d>=0&&J<=V&&J<=Y)return U(e,p,t.subarray(d,d+f));if(R(e,p,1+(Y<V)),p+=2,Y<V){g=b(k,O,0),m=k,y=b(C,P,0),w=C;var G=b(z,K,0);R(e,p,D-257),R(e,p+5,j-1),R(e,p+10,X-4),p+=14;for(var H=0;H<X;++H)R(e,p+3*H,z[h[H]]);p+=3*X;for(var Z=[$,F],Q=0;Q<2;++Q)for(var tt=Z[Q],H=0;H<tt.length;++H){var te=31&tt[H];R(e,p,G[te]),p+=z[te],te>15&&(R(e,p,tt[H]>>5&127),p+=tt[H]>>12)}}else g=S,m=v,y=A,w=x;for(var H=0;H<u;++H){var tn=r[H];if(tn>255){var te=tn>>18&31;T(e,p,g[te+257]),p+=m[te+257],te>7&&(R(e,p,tn>>23&31),p+=o[te]);var tr=31&tn;T(e,p,y[tr]),p+=w[tr],tr>3&&(T(e,p,tn>>5&8191),p+=l[tr])}else T(e,p,g[tn]),p+=m[tn]}return T(e,p,g[256]),p+m[256]},F=new a([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),j=new s(0),B=function(t,e,n,r,h,c){var u=c.z||t.length,d=new s(r+u+5*(1+Math.ceil(u/7e3))+h),p=d.subarray(r,d.length-h),g=c.l,y=7&(c.r||0);if(e){y&&(p[0]=c.r>>3);for(var w=F[e-1],_=w>>13,b=8191&w,v=(1<<n)-1,x=c.p||new i(32768),S=c.h||new i(v+1),A=Math.ceil(n/3),k=2*A,O=function(e){return(t[e]^t[e+1]<<A^t[e+2]<<k)&v},E=new a(25e3),I=new i(288),$=new i(32),R=0,T=0,N=c.i||0,D=0,W=c.w||0,M=0;N+2<u;++N){var j=O(N),B=32767&N,H=S[j];if(x[B]=H,S[j]=B,W<=N){var q=u-N;if((R>7e3||D>24576)&&(q>423||!g)){y=L(t,p,0,E,I,$,T,D,M,N-M,y),D=R=T=0,M=N;for(var z=0;z<286;++z)I[z]=0;for(var z=0;z<30;++z)$[z]=0}var K=2,X=0,J=b,V=B-H&32767;if(q>2&&j==O(N-V))for(var Y=Math.min(_,q)-1,G=Math.min(32767,N),Z=Math.min(258,q);V<=G&&--J&&B!=H;){if(t[N+K]==t[N+K-V]){for(var Q=0;Q<Z&&t[N+Q]==t[N+Q-V];++Q);if(Q>K){if(K=Q,X=V,Q>Y)break;for(var tt=Math.min(V,Q-2),te=0,z=0;z<tt;++z){var tn=N-V+z&32767,tr=x[tn],ts=tn-tr&32767;ts>te&&(te=ts,H=tn)}}}H=x[B=H],V+=B-H&32767}if(X){E[D++]=268435456|f[K]<<18|m[X];var ti=31&f[K],ta=31&m[X];T+=o[ti]+l[ta],++I[257+ti],++$[ta],W=N+K,++R}else E[D++]=t[N],++I[t[N]]}}for(N=Math.max(N,W);N<u;++N)E[D++]=t[N],++I[t[N]];y=L(t,p,g,E,I,$,T,D,M,N-M,y),g||(c.r=7&y|p[y/8|0]<<3,y-=7,c.h=S,c.p=x,c.i=N,c.w=W)}else{for(var N=c.w||0;N<u+g;N+=65535){var to=N+65535;to>=u&&(p[y/8|0]=g,to=u),y=U(p,y+1,t.subarray(N,to))}c.i=u}return P(d,0,r+C(y)+h)},H=function(){var t=1,e=0;return{p:function(n){for(var r=t,s=e,i=0|n.length,a=0;a!=i;){for(var o=Math.min(a+2655,i);a<o;++a)s+=r+=n[a];r=(65535&r)+15*(r>>16),s=(65535&s)+15*(s>>16)}t=r,e=s},d:function(){return t%=65521,e%=65521,(255&t)<<24|(65280&t)<<8|(255&e)<<8|e>>8}}},q=function(t,e,n,r,i){if(!i&&(i={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),o=new s(a.length+t.length);o.set(a),o.set(t,a.length),t=o,i.w=a.length}return B(t,null==e.level?6:e.level,null==e.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+e.mem,n,r,i)},z=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},K=function(t,e){var n=e.level;if(t[0]=120,t[1]=(0==n?0:n<6?1:9==n?3:2)<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var r=H();r.p(e.dictionary),z(t,2,r.d())}};function X(t,e){e||(e={});var n=H();n.p(t);var r=q(t,e,e.dictionary?6:2,4);return K(r,e),z(r,r.length-4,n.d()),r}var J="undefined"!=typeof TextDecoder&&new TextDecoder;try{J.decode(j,{stream:!0})}catch(t){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout},92451:function(t,e,n){n.d(e,{Z:function(){return r}});let r=(0,n(79205).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},49322:function(t,e,n){n.d(e,{Z:function(){return r}});let r=(0,n(79205).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},51817:function(t,e,n){n.d(e,{Z:function(){return r}});let r=(0,n(79205).Z)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},83229:function(t,e,n){n.d(e,{Z:function(){return r}});let r=(0,n(79205).Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},82023:function(t,e,n){n.d(e,{Z:function(){return r}});let r=(0,n(79205).Z)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]])},99376:function(t,e,n){var r=n(35475);n.o(r,"useParams")&&n.d(e,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(e,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(e,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(e,{useSearchParams:function(){return r.useSearchParams}})},41176:function(t,e,n){function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,s,i,a,o=[],l=!0,h=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(o.push(r.value),o.length!==e);l=!0);}catch(t){h=!0,s=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(h)throw s}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=({}).toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(e,{Z:function(){return s}})},41154:function(t,e,n){n.d(e,{Z:function(){return r}});function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}},71599:function(t,e,n){n.d(e,{z:function(){return o}});var r=n(2265),s=n(54887),i=n(98575),a=n(61188),o=t=>{let e,n;let{present:o,children:h}=t,c=function(t){var e,n;let[i,o]=r.useState(),h=r.useRef({}),c=r.useRef(t),u=r.useRef("none"),[d,f]=(e=t?"mounted":"unmounted",n={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},r.useReducer((t,e)=>n[t][e]??t,e));return r.useEffect(()=>{let t=l(h.current);u.current="mounted"===d?t:"none"},[d]),(0,a.b)(()=>{let e=h.current,n=c.current;if(n!==t){let r=u.current,s=l(e);t?f("MOUNT"):"none"===s||e?.display==="none"?f("UNMOUNT"):n&&r!==s?f("ANIMATION_OUT"):f("UNMOUNT"),c.current=t}},[t,f]),(0,a.b)(()=>{if(i){let t=t=>{let e=l(h.current).includes(t.animationName);t.target===i&&e&&s.flushSync(()=>f("ANIMATION_END"))},e=t=>{t.target===i&&(u.current=l(h.current))};return i.addEventListener("animationstart",e),i.addEventListener("animationcancel",t),i.addEventListener("animationend",t),()=>{i.removeEventListener("animationstart",e),i.removeEventListener("animationcancel",t),i.removeEventListener("animationend",t)}}f("ANIMATION_END")},[i,f]),{isPresent:["mounted","unmountSuspended"].includes(d),ref:r.useCallback(t=>{t&&(h.current=getComputedStyle(t)),o(t)},[])}}(o),u="function"==typeof h?h({present:c.isPresent}):r.Children.only(h),d=(0,i.e)(c.ref,(e=Object.getOwnPropertyDescriptor(u.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?u.ref:(e=Object.getOwnPropertyDescriptor(u,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?u.props.ref:u.props.ref||u.ref);return"function"==typeof h||c.isPresent?r.cloneElement(u,{ref:d}):null};function l(t){return t?.animationName||"none"}o.displayName="Presence"},46994:function(t,e,n){function r(t,e,n,r,s){r=r||{};var i=s.internal.scaleFactor,a=s.internal.getFontSize()/i,o=a*(s.getLineHeightFactor?s.getLineHeightFactor():1.15),l="",h=1;if(("middle"===r.valign||"bottom"===r.valign||"center"===r.halign||"right"===r.halign)&&(h=(l="string"==typeof t?t.split(/\r\n|\r|\n/g):t).length||1),n+=.8500000000000001*a,"middle"===r.valign?n-=h/2*o:"bottom"===r.valign&&(n-=h*o),"center"===r.halign||"right"===r.halign){var c=a;if("center"===r.halign&&(c*=.5),l&&h>=1){for(var u=0;u<l.length;u++)s.text(l[u],e-s.getStringUnitWidth(l[u])*c,n),n+=o;return s}e-=s.getStringUnitWidth(t)*c}return"justify"===r.halign?s.text(t,e,n,{maxWidth:r.maxWidth||100,align:"justify"}):s.text(t,e,n),s}n.d(e,{ZP:function(){return L}});var s,i={},a=function(){function t(t){this.jsPDFDocument=t,this.userStyles={textColor:t.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:t.internal.getFontSize(),fontStyle:t.internal.getFont().fontStyle,font:t.internal.getFont().fontName,lineWidth:t.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:t.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return t.setDefaults=function(t,e){void 0===e&&(e=null),e?e.__autoTableDocumentDefaults=t:i=t},t.unifyColor=function(t){return Array.isArray(t)?t:"number"==typeof t?[t,t,t]:"string"==typeof t?[t]:null},t.prototype.applyStyles=function(e,n){void 0===n&&(n=!1),e.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(e.fontStyle);var r,s,i,a=this.jsPDFDocument.internal.getFont(),o=a.fontStyle,l=a.fontName;if(e.font&&(l=e.font),e.fontStyle){o=e.fontStyle;var h=this.getFontList()[l];h&&-1===h.indexOf(o)&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(h[0]),o=h[0])}if(this.jsPDFDocument.setFont(l,o),e.fontSize&&this.jsPDFDocument.setFontSize(e.fontSize),!n){var c=t.unifyColor(e.fillColor);c&&(r=this.jsPDFDocument).setFillColor.apply(r,c),(c=t.unifyColor(e.textColor))&&(s=this.jsPDFDocument).setTextColor.apply(s,c),(c=t.unifyColor(e.lineColor))&&(i=this.jsPDFDocument).setDrawColor.apply(i,c),"number"==typeof e.lineWidth&&this.jsPDFDocument.setLineWidth(e.lineWidth)}},t.prototype.splitTextToSize=function(t,e,n){return this.jsPDFDocument.splitTextToSize(t,e,n)},t.prototype.rect=function(t,e,n,r,s){return this.jsPDFDocument.rect(t,e,n,r,s)},t.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},t.prototype.getTextWidth=function(t){return this.jsPDFDocument.getTextWidth(t)},t.prototype.getDocument=function(){return this.jsPDFDocument},t.prototype.setPage=function(t){this.jsPDFDocument.setPage(t)},t.prototype.addPage=function(){return this.jsPDFDocument.addPage()},t.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},t.prototype.getGlobalOptions=function(){return i||{}},t.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},t.prototype.pageSize=function(){var t=this.jsPDFDocument.internal.pageSize;return null==t.width&&(t={width:t.getWidth(),height:t.getHeight()}),t},t.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},t.prototype.getLineHeightFactor=function(){var t=this.jsPDFDocument;return t.getLineHeightFactor?t.getLineHeightFactor():1.15},t.prototype.getLineHeight=function(t){return t/this.scaleFactor()*this.getLineHeightFactor()},t.prototype.pageNumber=function(){var t=this.jsPDFDocument.internal.getCurrentPageInfo();return t?t.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},t}(),o=function(t,e){return(o=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function l(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}"function"==typeof SuppressedError&&SuppressedError;var h=function(t){function e(e){var n=t.call(this)||this;return n._element=e,n}return l(e,t),e}(Array);function c(t,e,n){return n.applyStyles(e,!0),(Array.isArray(t)?t:[t]).map(function(t){return n.getTextWidth(t)}).reduce(function(t,e){return Math.max(t,e)},0)}function u(t,e,n,r){var s=e.settings.tableLineWidth,i=e.settings.tableLineColor;t.applyStyles({lineWidth:s,lineColor:i});var a=d(s,!1);a&&t.rect(n.x,n.y,e.getWidth(t.pageSize().width),r.y-n.y,a)}function d(t,e){var n=t>0,r=e||0===e;return n&&r?"DF":n?"S":r?"F":null}function f(t,e){var n,r,s,i;if(Array.isArray(t=t||e)){if(t.length>=4)return{top:t[0],right:t[1],bottom:t[2],left:t[3]};if(3===t.length)return{top:t[0],right:t[1],bottom:t[2],left:t[1]};if(2===t.length)return{top:t[0],right:t[1],bottom:t[0],left:t[1]};t=1===t.length?t[0]:e}return"object"==typeof t?("number"==typeof t.vertical&&(t.top=t.vertical,t.bottom=t.vertical),"number"==typeof t.horizontal&&(t.right=t.horizontal,t.left=t.horizontal),{left:null!==(n=t.left)&&void 0!==n?n:e,top:null!==(r=t.top)&&void 0!==r?r:e,right:null!==(s=t.right)&&void 0!==s?s:e,bottom:null!==(i=t.bottom)&&void 0!==i?i:e}):("number"!=typeof t&&(t=e),{top:t,right:t,bottom:t,left:t})}function p(t,e){var n=f(e.settings.margin,0);return t.pageSize().width-(n.left+n.right)}function g(t,e){var n=function t(e,n){var r=n(e);return"rgba(0, 0, 0, 0)"!==r&&"transparent"!==r&&"initial"!==r&&"inherit"!==r?r:null==e.parentElement?null:t(e.parentElement,n)}(t,e);if(!n)return null;var r=n.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!r||!Array.isArray(r))return null;var s=[parseInt(r[1]),parseInt(r[2]),parseInt(r[3])];return 0===parseInt(r[4])||isNaN(s[0])||isNaN(s[1])||isNaN(s[2])?null:s}function m(t,e,n,r,s){void 0===r&&(r=!1),void 0===s&&(s=!1),o="string"==typeof e?n.document.querySelector(e):e;var i,a,o,l=Object.keys(t.getFontList()),c=t.scaleFactor(),u=[],d=[],p=[];if(!o)return console.error("Html table could not be found with input: ",e),{head:u,body:d,foot:p};for(var m=0;m<o.rows.length;m++){var y=o.rows[m],w=null===(a=null===(i=null==y?void 0:y.parentElement)||void 0===i?void 0:i.tagName)||void 0===a?void 0:a.toLowerCase(),_=function(t,e,n,r,s,i){for(var a=new h(r),o=0;o<r.cells.length;o++){var l=r.cells[o],c=n.getComputedStyle(l);if(s||"none"!==c.display){var u=void 0;i&&(u=function(t,e,n,r,s){var i={},a=96/72,o=g(e,function(t){return s.getComputedStyle(t).backgroundColor});null!=o&&(i.fillColor=o);var l=g(e,function(t){return s.getComputedStyle(t).color});null!=l&&(i.textColor=l);var h=function(t,e){var n=[t.paddingTop,t.paddingRight,t.paddingBottom,t.paddingLeft],r=96/(72/e),s=(parseInt(t.lineHeight)-parseInt(t.fontSize))/e/2,i=f(n.map(function(t){return parseInt(t||"0")/r}),0);return s>i.top&&(i.top=s),s>i.bottom&&(i.bottom=s),i}(r,n);h&&(i.cellPadding=h);var c="borderTopColor",u=a*n,d=r.borderTopWidth;if(r.borderBottomWidth===d&&r.borderRightWidth===d&&r.borderLeftWidth===d){var p=(parseFloat(d)||0)/u;p&&(i.lineWidth=p)}else i.lineWidth={top:(parseFloat(r.borderTopWidth)||0)/u,right:(parseFloat(r.borderRightWidth)||0)/u,bottom:(parseFloat(r.borderBottomWidth)||0)/u,left:(parseFloat(r.borderLeftWidth)||0)/u},!i.lineWidth.top&&(i.lineWidth.right?c="borderRightColor":i.lineWidth.bottom?c="borderBottomColor":i.lineWidth.left&&(c="borderLeftColor"));var m=g(e,function(t){return s.getComputedStyle(t)[c]});null!=m&&(i.lineColor=m);var y=["left","right","center","justify"];-1!==y.indexOf(r.textAlign)&&(i.halign=r.textAlign),-1!==(y=["middle","bottom","top"]).indexOf(r.verticalAlign)&&(i.valign=r.verticalAlign);var w=parseInt(r.fontSize||"");isNaN(w)||(i.fontSize=w/a);var _=function(t){var e="";return("bold"===t.fontWeight||"bolder"===t.fontWeight||parseInt(t.fontWeight)>=700)&&(e="bold"),("italic"===t.fontStyle||"oblique"===t.fontStyle)&&(e+="italic"),e}(r);_&&(i.fontStyle=_);var b=(r.fontFamily||"").toLowerCase();return -1!==t.indexOf(b)&&(i.font=b),i}(t,l,e,c,n)),a.push({rowSpan:l.rowSpan,colSpan:l.colSpan,styles:u,_element:l,content:function(t){var e=t.cloneNode(!0);return e.innerHTML=e.innerHTML.replace(/\n/g,"").replace(/ +/g," "),e.innerHTML=e.innerHTML.split(/<br.*?>/).map(function(t){return t.trim()}).join("\n"),e.innerText||e.textContent||""}(l)})}}var d=n.getComputedStyle(r);if(a.length>0&&(s||"none"!==d.display))return a}(l,c,n,y,r,s);_&&("thead"===w?u.push(_):"tfoot"===w?p.push(_):d.push(_))}return{head:u,body:d,foot:p}}function y(t,e,n,r,s){if(null==t)throw TypeError("Cannot convert undefined or null to object");for(var i=Object(t),a=1;a<arguments.length;a++){var o=arguments[a];if(null!=o)for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(i[l]=o[l])}return i}function w(t,e){var n,r,s,i,o,l,h,c,u,d,p,g,w,_,b,v,x,S,A,k,O,E,C,P,I,$,R=new a(t),T=R.getDocumentOptions(),N=R.getGlobalOptions();!function(t,e,n){for(var r=0,s=[t,e,n];r<s.length;r++){var i=s[r];i&&"object"!=typeof i&&console.error("The options parameter should be of type object, is: "+typeof i),i.startY&&"number"!=typeof i.startY&&(console.error("Invalid value for startY option",i.startY),delete i.startY)}}(N,T,e);var D=y({},N,T,e);"undefined"!=typeof window&&($=window);var W=function(t,e,n){for(var r={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},s=function(s){if("columnStyles"===s){var i=t[s],a=e[s],o=n[s];r.columnStyles=y({},i,a,o)}else{var l=[t,e,n].map(function(t){return t[s]||{}});r[s]=y({},l[0],l[1],l[2])}},i=0,a=Object.keys(r);i<a.length;i++)s(a[i]);return r}(N,T,e),M=function(t,e,n){for(var r={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},s=0,i=[t,e,n];s<i.length;s++){var a=i[s];a.didParseCell&&r.didParseCell.push(a.didParseCell),a.willDrawCell&&r.willDrawCell.push(a.willDrawCell),a.didDrawCell&&r.didDrawCell.push(a.didDrawCell),a.willDrawPage&&r.willDrawPage.push(a.willDrawPage),a.didDrawPage&&r.didDrawPage.push(a.didDrawPage)}return r}(N,T,e),U=(k=f(D.margin,40/R.scaleFactor()),O=null!==(n=D.startY,r=R.getLastAutoTable(),s=R.scaleFactor(),i=R.pageNumber(),o=!1,r&&r.startPageNumber&&(o=r.startPageNumber+r.pageNumber-1===i),l="number"==typeof n?n:(null==n||!1===n)&&o&&(null==r?void 0:r.finalY)!=null?r.finalY+20/s:null)&&void 0!==l?l:k.top,S=!0===D.showFoot?"everyPage":!1===D.showFoot?"never":null!==(h=D.showFoot)&&void 0!==h?h:"everyPage",A=!0===D.showHead?"everyPage":!1===D.showHead?"never":null!==(c=D.showHead)&&void 0!==c?c:"everyPage",E=null!==(u=D.useCss)&&void 0!==u&&u,C=D.theme||(E?"plain":"striped"),P=!!D.horizontalPageBreak,I=null!==(d=D.horizontalPageBreakRepeat)&&void 0!==d?d:null,{includeHiddenHtml:null!==(p=D.includeHiddenHtml)&&void 0!==p&&p,useCss:E,theme:C,startY:O,margin:k,pageBreak:null!==(g=D.pageBreak)&&void 0!==g?g:"auto",rowPageBreak:null!==(w=D.rowPageBreak)&&void 0!==w?w:"auto",tableWidth:null!==(_=D.tableWidth)&&void 0!==_?_:"auto",showHead:A,showFoot:S,tableLineWidth:null!==(b=D.tableLineWidth)&&void 0!==b?b:0,tableLineColor:null!==(v=D.tableLineColor)&&void 0!==v?v:200,horizontalPageBreak:P,horizontalPageBreakRepeat:I,horizontalPageBreakBehaviour:null!==(x=D.horizontalPageBreakBehaviour)&&void 0!==x?x:"afterAllRows"}),L=function(t,e,n){var r,s,i,a,o,l=e.head||[],h=e.body||[],c=e.foot||[];if(e.html){var u=e.includeHiddenHtml;if(n){var d=m(t,e.html,n,u,e.useCss)||{};l=d.head||l,h=d.body||l,c=d.foot||l}else console.error("Cannot parse html in non browser environment")}return{columns:e.columns||(r=l,s=h,i=c,a=r[0]||s[0]||i[0]||[],o=[],Object.keys(a).filter(function(t){return"_element"!==t}).forEach(function(t){var e,n=1;"object"!=typeof(e=Array.isArray(a)?a[parseInt(t)]:a[t])||Array.isArray(e)||(n=(null==e?void 0:e.colSpan)||1);for(var r=0;r<n;r++){var s={dataKey:Array.isArray(a)?o.length:t+(r>0?"_".concat(r):"")};o.push(s)}}),o),head:l,body:h,foot:c}}(R,D,$);return{id:e.tableId,content:L,hooks:M,styles:W,settings:U}}var _=function(t,e,n){this.table=e,this.pageNumber=e.pageNumber,this.settings=e.settings,this.cursor=n,this.doc=t.getDocument()},b=function(t){function e(e,n,r,s,i,a){var o=t.call(this,e,n,a)||this;return o.cell=r,o.row=s,o.column=i,o.section=s.section,o}return l(e,t),e}(_),v=function(){function t(t,e){this.pageNumber=1,this.id=t.id,this.settings=t.settings,this.styles=t.styles,this.hooks=t.hooks,this.columns=e.columns,this.head=e.head,this.body=e.body,this.foot=e.foot}return t.prototype.getHeadHeight=function(t){return this.head.reduce(function(e,n){return e+n.getMaxCellHeight(t)},0)},t.prototype.getFootHeight=function(t){return this.foot.reduce(function(e,n){return e+n.getMaxCellHeight(t)},0)},t.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},t.prototype.callCellHooks=function(t,e,n,r,s,i){for(var a=0;a<e.length;a++){var o=!1===(0,e[a])(new b(t,this,n,r,s,i));if(n.text=Array.isArray(n.text)?n.text:[n.text],o)return!1}return!0},t.prototype.callEndPageHooks=function(t,e){t.applyStyles(t.userStyles);for(var n=0,r=this.hooks.didDrawPage;n<r.length;n++)(0,r[n])(new _(t,this,e))},t.prototype.callWillDrawPageHooks=function(t,e){for(var n=0,r=this.hooks.willDrawPage;n<r.length;n++)(0,r[n])(new _(t,this,e))},t.prototype.getWidth=function(t){if("number"==typeof this.settings.tableWidth)return this.settings.tableWidth;if("wrap"===this.settings.tableWidth)return this.columns.reduce(function(t,e){return t+e.wrappedWidth},0);var e=this.settings.margin;return t-e.left-e.right},t}(),x=function(){function t(t,e,n,r,s){void 0===s&&(s=!1),this.height=0,this.raw=t,t instanceof h&&(this.raw=t._element,this.element=t._element),this.index=e,this.section=n,this.cells=r,this.spansMultiplePages=s}return t.prototype.getMaxCellHeight=function(t){var e=this;return t.reduce(function(t,n){var r;return Math.max(t,(null===(r=e.cells[n.index])||void 0===r?void 0:r.height)||0)},0)},t.prototype.hasRowSpan=function(t){var e=this;return t.filter(function(t){var n=e.cells[t.index];return!!n&&n.rowSpan>1}).length>0},t.prototype.canEntireRowFit=function(t,e){return this.getMaxCellHeight(e)<=t},t.prototype.getMinimumRowHeight=function(t,e){var n=this;return t.reduce(function(t,r){var s=n.cells[r.index];if(!s)return 0;var i=e.getLineHeight(s.styles.fontSize),a=s.padding("vertical")+i;return a>t?a:t},0)},t}(),S=function(){function t(t,e,n){this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=e,this.section=n,this.raw=t;var r,s=t;null==t||"object"!=typeof t||Array.isArray(t)?(this.rowSpan=1,this.colSpan=1):(this.rowSpan=t.rowSpan||1,this.colSpan=t.colSpan||1,s=null!==(r=t.content)&&void 0!==r?r:t,t._element&&(this.raw=t._element));var i=null!=s?""+s:"";this.text=i.split(/\r\n|\r|\n/g)}return t.prototype.getTextPos=function(){if("top"===this.styles.valign)t=this.y+this.padding("top");else if("bottom"===this.styles.valign)t=this.y+this.height-this.padding("bottom");else{var t,e,n=this.height-this.padding("vertical");t=this.y+n/2+this.padding("top")}if("right"===this.styles.halign)e=this.x+this.width-this.padding("right");else if("center"===this.styles.halign){var r=this.width-this.padding("horizontal");e=this.x+r/2+this.padding("left")}else e=this.x+this.padding("left");return{x:e,y:t}},t.prototype.getContentHeight=function(t,e){return void 0===e&&(e=1.15),Math.max((Array.isArray(this.text)?this.text.length:1)*(this.styles.fontSize/t*e)+this.padding("vertical"),this.styles.minCellHeight)},t.prototype.padding=function(t){var e=f(this.styles.cellPadding,0);return"vertical"===t?e.top+e.bottom:"horizontal"===t?e.left+e.right:e[t]},t}(),A=function(){function t(t,e,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=t,this.raw=e,this.index=n}return t.prototype.getMaxCustomCellWidth=function(t){for(var e=0,n=0,r=t.allRows();n<r.length;n++){var s=r[n].cells[this.index];s&&"number"==typeof s.styles.cellWidth&&(e=Math.max(e,s.styles.cellWidth))}return e},t}();function k(t,e,n){for(var r=e,s=t.reduce(function(t,e){return t+e.wrappedWidth},0),i=0;i<t.length;i++){var a=t[i],o=a.wrappedWidth/s*r,l=a.width+o,h=n(a),c=l<h?h:l;e-=c-a.width,a.width=c}if(e=Math.round(1e10*e)/1e10){var u=t.filter(function(t){return!(e<0)||t.width>n(t)});u.length&&(e=k(u,e,n))}return e}function O(t,e,n,r,s){return t.map(function(t){return function(t,e,n,r,s){var i=1e4*r.scaleFactor();if((e=Math.ceil(e*i)/i)>=c(t,n,r))return t;for(;e<c(t+s,n,r)&&!(t.length<=1);)t=t.substring(0,t.length-1);return t.trim()+s}(t,e,n,r,s)})}function E(t,e){var n=new a(t),r=function(t,e){var n=t.content,r=n.columns.map(function(t,e){var n;return new A("object"==typeof t&&null!==(n=t.dataKey)&&void 0!==n?n:e,t,e)});if(0===n.head.length){var s=P(r,"head");s&&n.head.push(s)}if(0===n.foot.length){var s=P(r,"foot");s&&n.foot.push(s)}var i=t.settings.theme,a=t.styles;return{columns:r,head:C("head",n.head,r,a,i,e),body:C("body",n.body,r,a,i,e),foot:C("foot",n.foot,r,a,i,e)}}(e,n.scaleFactor()),s=new v(e,r);return!function(t,e){n=t.scaleFactor(),r=e.settings.horizontalPageBreak,s=p(t,e),e.allRows().forEach(function(i){for(var a=0,o=e.columns;a<o.length;a++){var l=o[a],h=i.cells[l.index];if(h){var u=e.hooks.didParseCell;e.callCellHooks(t,u,h,i,l,null);var d=h.padding("horizontal");h.contentWidth=c(h.text,h.styles,t)+d;var f=c(h.text.join(" ").split(/[^\S\u00A0]+/),h.styles,t);if(h.minReadableWidth=f+h.padding("horizontal"),"number"==typeof h.styles.cellWidth)h.minWidth=h.styles.cellWidth,h.wrappedWidth=h.styles.cellWidth;else if("wrap"===h.styles.cellWidth||!0===r)h.contentWidth>s?(h.minWidth=s,h.wrappedWidth=s):(h.minWidth=h.contentWidth,h.wrappedWidth=h.contentWidth);else{var p=10/n;h.minWidth=h.styles.minCellWidth||p,h.wrappedWidth=h.contentWidth,h.minWidth>h.wrappedWidth&&(h.wrappedWidth=h.minWidth)}}}}),e.allRows().forEach(function(t){for(var n=0,r=e.columns;n<r.length;n++){var s=r[n],i=t.cells[s.index];if(i&&1===i.colSpan)s.wrappedWidth=Math.max(s.wrappedWidth,i.wrappedWidth),s.minWidth=Math.max(s.minWidth,i.minWidth),s.minReadableWidth=Math.max(s.minReadableWidth,i.minReadableWidth);else{var a=e.styles.columnStyles[s.dataKey]||e.styles.columnStyles[s.index]||{},o=a.cellWidth||a.minCellWidth;o&&"number"==typeof o&&(s.minWidth=o,s.wrappedWidth=o)}i&&(i.colSpan>1&&!s.minWidth&&(s.minWidth=i.minWidth),i.colSpan>1&&!s.wrappedWidth&&(s.wrappedWidth=i.minWidth))}});var n,r,s,i=[],a=0;e.columns.forEach(function(t){var n=t.getMaxCustomCellWidth(e);n?t.width=n:(t.width=t.wrappedWidth,i.push(t)),a+=t.width});var o=e.getWidth(t.pageSize().width)-a;o&&(o=k(i,o,function(t){return Math.max(t.minReadableWidth,t.minWidth)})),o&&(o=k(i,o,function(t){return t.minWidth})),o=Math.abs(o),!e.settings.horizontalPageBreak&&o>.1/t.scaleFactor()&&(o=o<1?o:Math.round(o),console.log("Of the table content, ".concat(o," units width could not fit page"))),function(t){for(var e=t.allRows(),n=0;n<e.length;n++)for(var r=e[n],s=null,i=0,a=0,o=0;o<t.columns.length;o++){var l=t.columns[o];if((a-=1)>1&&t.columns[o+1])i+=l.width,delete r.cells[l.index];else if(s){var h=s;delete r.cells[l.index],s=null,h.width=l.width+i}else{var h=r.cells[l.index];if(!h)continue;if(a=h.colSpan,i=0,h.colSpan>1){s=h,i+=l.width;continue}h.width=l.width+i}}}(e),function(t,e){for(var n={count:0,height:0},r=0,s=t.allRows();r<s.length;r++){for(var i=s[r],a=0,o=t.columns;a<o.length;a++){var l=o[a],h=i.cells[l.index];if(h){e.applyStyles(h.styles,!0);var c=h.width-h.padding("horizontal");if("linebreak"===h.styles.overflow)h.text=e.splitTextToSize(h.text,c+1/e.scaleFactor(),{fontSize:h.styles.fontSize});else if("ellipsize"===h.styles.overflow)h.text=O(h.text,c,h.styles,e,"...");else if("hidden"===h.styles.overflow)h.text=O(h.text,c,h.styles,e,"");else if("function"==typeof h.styles.overflow){var u=h.styles.overflow(h.text,c);"string"==typeof u?h.text=[u]:h.text=u}h.contentHeight=h.getContentHeight(e.scaleFactor(),e.getLineHeightFactor());var d=h.contentHeight/h.rowSpan;h.rowSpan>1&&n.count*n.height<d*h.rowSpan?n={height:d,count:h.rowSpan}:n&&n.count>0&&n.height>d&&(d=n.height),d>i.height&&(i.height=d)}}n.count--}}(e,t),function(t){for(var e={},n=1,r=t.allRows(),s=0;s<r.length;s++)for(var i=r[s],a=0,o=t.columns;a<o.length;a++){var l=o[a],h=e[l.index];if(n>1)n--,delete i.cells[l.index];else if(h)h.cell.height+=i.height,n=h.cell.colSpan,delete i.cells[l.index],h.left--,h.left<=1&&delete e[l.index];else{var c=i.cells[l.index];if(!c)continue;if(c.height=i.height,c.rowSpan>1){var u=r.length-s,d=c.rowSpan>u?u:c.rowSpan;e[l.index]={cell:c,left:d,row:i}}}}}(e)}(n,s),n.applyStyles(n.userStyles),s}function C(t,e,n,r,s,i){var a={};return e.map(function(e,o){for(var l=0,h={},c=0,u=0,d=0;d<n.length;d++){var f=n[d];if(null==a[f.index]||0===a[f.index].left){if(0===u){var p=void 0;p=Array.isArray(e)?e[f.index-c-l]:e[f.dataKey];var g={};"object"!=typeof p||Array.isArray(p)||(g=(null==p?void 0:p.styles)||{});var m=new S(p,function(t,e,n,r,s,i,a){var o,l={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}}[r];"head"===t?o=s.headStyles:"body"===t?o=s.bodyStyles:"foot"===t&&(o=s.footStyles);var h=y({},l.table,l[t],s.styles,o),c=s.columnStyles[e.dataKey]||s.columnStyles[e.index]||{},u="body"===t&&n%2==0?y({},l.alternateRow,s.alternateRowStyles):{},d=y({},{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/i,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0},h,u,"body"===t?c:{});return y(d,a)}(t,f,o,s,r,i,g),t);h[f.dataKey]=m,h[f.index]=m,u=m.colSpan-1,a[f.index]={left:m.rowSpan-1,times:u}}else u--,c++}else a[f.index].left--,u=a[f.index].times,l++}return new x(e,o,t,h)})}function P(t,e){var n={};return t.forEach(function(t){if(null!=t.raw){var r=function(t,e){if("head"===t){if("object"==typeof e)return e.header||null;if("string"==typeof e||"number"==typeof e)return e}else if("foot"===t&&"object"==typeof e)return e.footer;return null}(e,t.raw);null!=r&&(n[t.dataKey]=r)}}),Object.keys(n).length>0?n:null}function I(t,e){var n=e.settings,r=n.startY,s=n.margin,i={x:s.left,y:r},o=e.getHeadHeight(e.columns)+e.getFootHeight(e.columns),l=r+s.bottom+o;"avoid"===n.pageBreak&&(l+=e.body.reduce(function(t,e){return t+e.height},0));var h=new a(t);("always"===n.pageBreak||null!=n.startY&&l>h.pageSize().height)&&(U(h),i.y=s.top),e.callWillDrawPageHooks(h,i);var c=y({},i);e.startPageNumber=h.pageNumber(),n.horizontalPageBreak?function(t,e,n,r){var s=function(t,e){for(var n=[],r=0;r<e.columns.length;r++){var s=function(t,e,n){void 0===n&&(n={});var r,s=p(t,e),i=new Map,a=[],o=[],l=[];Array.isArray(e.settings.horizontalPageBreakRepeat)?l=e.settings.horizontalPageBreakRepeat:("string"==typeof e.settings.horizontalPageBreakRepeat||"number"==typeof e.settings.horizontalPageBreakRepeat)&&(l=[e.settings.horizontalPageBreakRepeat]),l.forEach(function(t){var n=e.columns.find(function(e){return e.dataKey===t||e.index===t});n&&!i.has(n.index)&&(i.set(n.index,!0),a.push(n.index),o.push(e.columns[n.index]),s-=n.wrappedWidth)});for(var h=!0,c=null!==(r=null==n?void 0:n.start)&&void 0!==r?r:0;c<e.columns.length;){if(i.has(c)){c++;continue}var u=e.columns[c].wrappedWidth;if(h||s>=u)h=!1,a.push(c),o.push(e.columns[c]),s-=u;else break;c++}return{colIndexes:a,columns:o,lastIndex:c-1}}(t,e,{start:r});s.columns.length&&(n.push(s),r=s.lastIndex)}return n}(t,e);if("afterAllRows"===e.settings.horizontalPageBreakBehaviour)s.forEach(function(s,i){var a;t.applyStyles(t.userStyles),i>0?M(t,e,n,r,s.columns,!0):$(t,e,r,s.columns),a=s.columns,t.applyStyles(t.userStyles),e.body.forEach(function(s,i){var o=i===e.body.length-1;N(t,e,s,o,n,r,a)}),T(t,e,r,s.columns)});else for(var i=-1,a=s[0];i<e.body.length-1;)!function(){var o=i;if(a){t.applyStyles(t.userStyles);var l=a.columns;i>=0?M(t,e,n,r,l,!0):$(t,e,r,l),o=R(t,e,i+1,r,l),T(t,e,r,l)}var h=o-i;s.slice(1).forEach(function(s){t.applyStyles(t.userStyles),M(t,e,n,r,s.columns,!0),R(t,e,i+1,r,s.columns,h),T(t,e,r,s.columns)}),i=o}()}(h,e,c,i):(h.applyStyles(h.userStyles),("firstPage"===n.showHead||"everyPage"===n.showHead)&&e.head.forEach(function(t){return D(h,e,t,i,e.columns)}),h.applyStyles(h.userStyles),e.body.forEach(function(t,n){var r=n===e.body.length-1;N(h,e,t,r,c,i,e.columns)}),h.applyStyles(h.userStyles),("lastPage"===n.showFoot||"everyPage"===n.showFoot)&&e.foot.forEach(function(t){return D(h,e,t,i,e.columns)})),u(h,e,c,i),e.callEndPageHooks(h,i),e.finalY=i.y,t.lastAutoTable=e,h.applyStyles(h.userStyles)}function $(t,e,n,r){var s=e.settings;t.applyStyles(t.userStyles),("firstPage"===s.showHead||"everyPage"===s.showHead)&&e.head.forEach(function(s){return D(t,e,s,n,r)})}function R(t,e,n,r,s,i){t.applyStyles(t.userStyles);var a=Math.min(n+(i=null!=i?i:e.body.length),e.body.length),o=-1;return e.body.slice(n,a).forEach(function(i,a){var l=n+a===e.body.length-1,h=W(t,e,l,r);i.canEntireRowFit(h,s)&&(D(t,e,i,r,s),o=n+a)}),o}function T(t,e,n,r){var s=e.settings;t.applyStyles(t.userStyles),("lastPage"===s.showFoot||"everyPage"===s.showFoot)&&e.foot.forEach(function(s){return D(t,e,s,n,r)})}function N(t,e,n,r,s,i,a){var o=W(t,e,r,i);if(n.canEntireRowFit(o,a))D(t,e,n,i,a);else if(function(t,e,n,r){var s=t.pageSize().height,i=r.settings.margin,a=s-(i.top+i.bottom);"body"===e.section&&(a-=r.getHeadHeight(r.columns)+r.getFootHeight(r.columns));var o=e.getMinimumRowHeight(r.columns,t);if(o>a)return console.log("Will not be able to print row ".concat(e.index," correctly since it's minimum height is larger than page height")),!0;if(!(o<n))return!1;var l=e.hasRowSpan(r.columns);return e.getMaxCellHeight(r.columns)>a?(l&&console.log("The content of row ".concat(e.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!l&&"avoid"!==r.settings.rowPageBreak}(t,n,o,e)){var l=function(t,e,n,r){var s={};t.spansMultiplePages=!0,t.height=0;for(var i=0,a=0,o=n.columns;a<o.length;a++){var l=o[a],h=t.cells[l.index];if(h){Array.isArray(h.text)||(h.text=[h.text]);var c=new S(h.raw,h.styles,h.section);(c=y(c,h)).text=[];var u=function(t,e,n){var r=n.getLineHeight(t.styles.fontSize);return Math.max(0,Math.floor((e-t.padding("vertical"))/r))}(h,e,r);h.text.length>u&&(c.text=h.text.splice(u,h.text.length));var d=r.scaleFactor(),f=r.getLineHeightFactor();h.contentHeight=h.getContentHeight(d,f),h.contentHeight>=e&&(h.contentHeight=e,c.styles.minCellHeight-=e),h.contentHeight>t.height&&(t.height=h.contentHeight),c.contentHeight=c.getContentHeight(d,f),c.contentHeight>i&&(i=c.contentHeight),s[l.index]=c}}var p=new x(t.raw,-1,t.section,s,!0);p.height=i;for(var g=0,m=n.columns;g<m.length;g++){var l=m[g],c=p.cells[l.index];c&&(c.height=p.height);var h=t.cells[l.index];h&&(h.height=t.height)}return p}(n,o,e,t);D(t,e,n,i,a),M(t,e,s,i,a),N(t,e,l,r,s,i,a)}else M(t,e,s,i,a),N(t,e,n,r,s,i,a)}function D(t,e,n,s,i){s.x=e.settings.margin.left;for(var a=0;a<i.length;a++){var o=i[a],l=n.cells[o.index];if(!l||(t.applyStyles(l.styles),l.x=s.x,l.y=s.y,!1===e.callCellHooks(t,e.hooks.willDrawCell,l,n,o,s))){s.x+=o.width;continue}!function(t,e,n){var r=e.styles;if(t.getDocument().setFillColor(t.getDocument().getFillColor()),"number"==typeof r.lineWidth){var s=d(r.lineWidth,r.fillColor);s&&t.rect(e.x,n.y,e.width,e.height,s)}else"object"==typeof r.lineWidth&&(r.fillColor&&t.rect(e.x,n.y,e.width,e.height,"F"),function(t,e,n,r){var s,i,a,o;function l(e,n,r,s,i){t.getDocument().setLineWidth(e),t.getDocument().line(n,r,s,i,"S")}r.top&&(s=n.x,i=n.y,a=n.x+e.width,o=n.y,r.right&&(a+=.5*r.right),r.left&&(s-=.5*r.left),l(r.top,s,i,a,o)),r.bottom&&(s=n.x,i=n.y+e.height,a=n.x+e.width,o=n.y+e.height,r.right&&(a+=.5*r.right),r.left&&(s-=.5*r.left),l(r.bottom,s,i,a,o)),r.left&&(s=n.x,i=n.y,a=n.x,o=n.y+e.height,r.top&&(i-=.5*r.top),r.bottom&&(o+=.5*r.bottom),l(r.left,s,i,a,o)),r.right&&(s=n.x+e.width,i=n.y,a=n.x+e.width,o=n.y+e.height,r.top&&(i-=.5*r.top),r.bottom&&(o+=.5*r.bottom),l(r.right,s,i,a,o))}(t,e,n,r.lineWidth))}(t,l,s);var h=l.getTextPos();r(l.text,h.x,h.y,{halign:l.styles.halign,valign:l.styles.valign,maxWidth:Math.ceil(l.width-l.padding("left")-l.padding("right"))},t.getDocument()),e.callCellHooks(t,e.hooks.didDrawCell,l,n,o,s),s.x+=o.width}s.y+=n.height}function W(t,e,n,r){var s=e.settings.margin.bottom,i=e.settings.showFoot;return("everyPage"===i||"lastPage"===i&&n)&&(s+=e.getFootHeight(e.columns)),t.pageSize().height-r.y-s}function M(t,e,n,r,s,i){void 0===s&&(s=[]),void 0===i&&(i=!1),t.applyStyles(t.userStyles),"everyPage"!==e.settings.showFoot||i||e.foot.forEach(function(n){return D(t,e,n,r,s)}),e.callEndPageHooks(t,r);var a=e.settings.margin;u(t,e,n,r),U(t),e.pageNumber++,r.x=a.left,r.y=a.top,n.y=a.top,e.callWillDrawPageHooks(t,r),"everyPage"===e.settings.showHead&&(e.head.forEach(function(n){return D(t,e,n,r,s)}),t.applyStyles(t.userStyles))}function U(t){var e=t.pageNumber();return t.setPage(e+1),t.pageNumber()===e&&(t.addPage(),!0)}function L(t,e){var n=w(t,e),r=E(t,n);I(t,r)}try{if("undefined"!=typeof window&&window){var F=window,j=F.jsPDF||(null===(s=F.jspdf)||void 0===s?void 0:s.jsPDF);j&&(j.API.autoTable=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return I(this,E(this,w(this,t[0]))),this},j.API.lastAutoTable=!1,j.API.autoTableText=function(t,e,n,s){r(t,e,n,s,this)},j.API.autoTableSetDefaults=function(t){return a.setDefaults(t,this),this},j.autoTableSetDefaults=function(t,e){a.setDefaults(t,e)},j.API.autoTableHtmlToJson=function(t,e){if(void 0===e&&(e=!1),"undefined"==typeof window)return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var n,r=m(new a(this),t,window,e,!1),s=r.head,i=r.body;return{columns:(null===(n=s[0])||void 0===n?void 0:n.map(function(t){return t.content}))||[],rows:i,data:i}})}}catch(t){console.error("Could not apply autoTable plugin",t)}},6103:function(t,e,n){let r,s,i,a;function o(t,e,n,r,s){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(t,n):s?s.value=n:e.set(t,n),n}function l(t,e,n,r){if("a"===n&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)}n.d(e,{ZP:function(){return r_}});let h=function(){let{crypto:t}=globalThis;if(t?.randomUUID)return h=t.randomUUID.bind(t),t.randomUUID();let e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,t=>(+t^n()&15>>+t/4).toString(16))};function c(t){return"object"==typeof t&&null!==t&&("name"in t&&"AbortError"===t.name||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}let u=t=>{if(t instanceof Error)return t;if("object"==typeof t&&null!==t){try{if("[object Error]"===Object.prototype.toString.call(t)){let e=Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return Error(JSON.stringify(t))}catch{}}return Error(t)};class d extends Error{}class f extends d{constructor(t,e,n,r){super(`${f.makeMessage(t,e,n)}`),this.status=t,this.headers=r,this.requestID=r?.get("x-request-id"),this.error=e,this.code=e?.code,this.param=e?.param,this.type=e?.type}static makeMessage(t,e,n){let r=e?.message?"string"==typeof e.message?e.message:JSON.stringify(e.message):e?JSON.stringify(e):n;return t&&r?`${t} ${r}`:t?`${t} status code (no body)`:r||"(no status code or body)"}static generate(t,e,n,r){if(!t||!r)return new g({message:n,cause:u(e)});let s=e?.error;return 400===t?new y(t,s,n,r):401===t?new w(t,s,n,r):403===t?new _(t,s,n,r):404===t?new b(t,s,n,r):409===t?new v(t,s,n,r):422===t?new x(t,s,n,r):429===t?new S(t,s,n,r):t>=500?new A(t,s,n,r):new f(t,s,n,r)}}class p extends f{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class g extends f{constructor({message:t,cause:e}){super(void 0,void 0,t||"Connection error.",void 0),e&&(this.cause=e)}}class m extends g{constructor({message:t}={}){super({message:t??"Request timed out."})}}class y extends f{}class w extends f{}class _ extends f{}class b extends f{}class v extends f{}class x extends f{}class S extends f{}class A extends f{}class k extends d{constructor(){super("Could not parse response content as the length limit was reached")}}class O extends d{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class E extends Error{constructor(t){super(t)}}let C=/^[a-z][a-z0-9+.-]*:/i,P=t=>C.test(t),I=t=>(I=Array.isArray)(t),$=I;function R(t){return"object"!=typeof t?{}:t??{}}function T(t){return null!=t&&"object"==typeof t&&!Array.isArray(t)}let N=(t,e)=>{if("number"!=typeof e||!Number.isInteger(e))throw new d(`${t} must be an integer`);if(e<0)throw new d(`${t} must be a positive integer`);return e},D=t=>{try{return JSON.parse(t)}catch(t){return}},W=t=>new Promise(e=>setTimeout(e,t)),M="6.15.0",U=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,L=()=>{let t="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===t)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":M,"X-Stainless-OS":j(Deno.build.os),"X-Stainless-Arch":F(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":M,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===t)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":M,"X-Stainless-OS":j(globalThis.process.platform??"unknown"),"X-Stainless-Arch":F(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:t,pattern:e}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let n=e.exec(navigator.userAgent);if(n){let e=n[1]||0,r=n[2]||0,s=n[3]||0;return{browser:t,version:`${e}.${r}.${s}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":M,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":M,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},F=t=>"x32"===t?"x32":"x86_64"===t||"x64"===t?"x64":"arm"===t?"arm":"aarch64"===t||"arm64"===t?"arm64":t?`other:${t}`:"unknown",j=t=>(t=t.toLowerCase()).includes("ios")?"iOS":"android"===t?"Android":"darwin"===t?"MacOS":"win32"===t?"Windows":"freebsd"===t?"FreeBSD":"openbsd"===t?"OpenBSD":"linux"===t?"Linux":t?`Other:${t}`:"Unknown",B=()=>r??(r=L());function H(...t){let e=globalThis.ReadableStream;if(void 0===e)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function q(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return H({start(){},async pull(t){let{done:n,value:r}=await e.next();n?t.close():t.enqueue(r)},async cancel(){await e.return?.()}})}function z(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function K(t){if(null===t||"object"!=typeof t)return;if(t[Symbol.asyncIterator]){await t[Symbol.asyncIterator]().return?.();return}let e=t.getReader(),n=e.cancel();e.releaseLock(),await n}let X=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),J="RFC3986",V=t=>String(t),Y={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:V},G=(t,e)=>(G=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(t,e),Z=(()=>{let t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})();function Q(t,e){if(I(t)){let n=[];for(let r=0;r<t.length;r+=1)n.push(e(t[r]));return n}return e(t)}let tt={brackets:t=>String(t)+"[]",comma:"comma",indices:(t,e)=>String(t)+"["+e+"]",repeat:t=>String(t)},te=function(t,e){Array.prototype.push.apply(t,I(e)?e:[e])},tn={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(t,e,n,r,s)=>{if(0===t.length)return t;let i=t;if("symbol"==typeof t?i=Symbol.prototype.toString.call(t):"string"!=typeof t&&(i=String(t)),"iso-8859-1"===n)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"});let a="";for(let t=0;t<i.length;t+=1024){let e=i.length>=1024?i.slice(t,t+1024):i,n=[];for(let t=0;t<e.length;++t){let r=e.charCodeAt(t);if(45===r||46===r||95===r||126===r||r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||"RFC1738"===s&&(40===r||41===r)){n[n.length]=e.charAt(t);continue}if(r<128){n[n.length]=Z[r];continue}if(r<2048){n[n.length]=Z[192|r>>6]+Z[128|63&r];continue}if(r<55296||r>=57344){n[n.length]=Z[224|r>>12]+Z[128|r>>6&63]+Z[128|63&r];continue}t+=1,r=65536+((1023&r)<<10|1023&e.charCodeAt(t)),n[n.length]=Z[240|r>>18]+Z[128|r>>12&63]+Z[128|r>>6&63]+Z[128|63&r]}a+=n.join("")}return a},encodeValuesOnly:!1,format:J,formatter:V,indices:!1,serializeDate:t=>(s??(s=Function.prototype.call.bind(Date.prototype.toISOString)))(t),skipNulls:!1,strictNullHandling:!1},tr={};function ts(t){let e;return(i??(i=(e=new globalThis.TextEncoder).encode.bind(e)))(t)}function ti(t){let e;return(a??(a=(e=new globalThis.TextDecoder).decode.bind(e)))(t)}class ta{constructor(){ex.set(this,void 0),eS.set(this,void 0),o(this,ex,new Uint8Array,"f"),o(this,eS,null,"f")}decode(t){let e;if(null==t)return[];let n=t instanceof ArrayBuffer?new Uint8Array(t):"string"==typeof t?ts(t):t;o(this,ex,function(t){let e=0;for(let n of t)e+=n.length;let n=new Uint8Array(e),r=0;for(let e of t)n.set(e,r),r+=e.length;return n}([l(this,ex,"f"),n]),"f");let r=[];for(;null!=(e=function(t,e){for(let n=e??0;n<t.length;n++){if(10===t[n])return{preceding:n,index:n+1,carriage:!1};if(13===t[n])return{preceding:n,index:n+1,carriage:!0}}return null}(l(this,ex,"f"),l(this,eS,"f")));){if(e.carriage&&null==l(this,eS,"f")){o(this,eS,e.index,"f");continue}if(null!=l(this,eS,"f")&&(e.index!==l(this,eS,"f")+1||e.carriage)){r.push(ti(l(this,ex,"f").subarray(0,l(this,eS,"f")-1))),o(this,ex,l(this,ex,"f").subarray(l(this,eS,"f")),"f"),o(this,eS,null,"f");continue}let t=null!==l(this,eS,"f")?e.preceding-1:e.preceding,n=ti(l(this,ex,"f").subarray(0,t));r.push(n),o(this,ex,l(this,ex,"f").subarray(e.index),"f"),o(this,eS,null,"f")}return r}flush(){return l(this,ex,"f").length?this.decode("\n"):[]}}ex=new WeakMap,eS=new WeakMap,ta.NEWLINE_CHARS=new Set(["\n","\r"]),ta.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let to={off:0,error:200,warn:300,info:400,debug:500},tl=(t,e,n)=>{if(t){if(Object.prototype.hasOwnProperty.call(to,t))return t;tf(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(to))}`)}};function th(){}function tc(t,e,n){return!e||to[t]>to[n]?th:e[t].bind(e)}let tu={error:th,warn:th,info:th,debug:th},td=new WeakMap;function tf(t){let e=t.logger,n=t.logLevel??"off";if(!e)return tu;let r=td.get(e);if(r&&r[0]===n)return r[1];let s={error:tc("error",e,n),warn:tc("warn",e,n),info:tc("info",e,n),debug:tc("debug",e,n)};return td.set(e,[n,s]),s}let tp=t=>(t.options&&(t.options={...t.options},delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([t,e])=>[t,"authorization"===t.toLowerCase()||"cookie"===t.toLowerCase()||"set-cookie"===t.toLowerCase()?"***":e]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);class tg{constructor(t,e,n){this.iterator=t,eA.set(this,void 0),this.controller=e,o(this,eA,n,"f")}static fromSSEResponse(t,e,n){let r=!1,s=n?tf(n):console;return new tg(async function*(){if(r)throw new d("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(let r of tm(t,e))if(!n){if(r.data.startsWith("[DONE]")){n=!0;continue}if(null!==r.event&&r.event.startsWith("thread.")){let t;try{t=JSON.parse(r.data)}catch(t){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),t}if("error"==r.event)throw new f(void 0,t.error,t.message,void 0);yield{event:r.event,data:t}}else{let e;try{e=JSON.parse(r.data)}catch(t){throw s.error("Could not parse message into JSON:",r.data),s.error("From chunk:",r.raw),t}if(e&&e.error)throw new f(void 0,e.error,void 0,t.headers);yield e}}n=!0}catch(t){if(c(t))return;throw t}finally{n||e.abort()}},e,n)}static fromReadableStream(t,e,n){let r=!1;async function*s(){let e=new ta;for await(let n of z(t))for(let t of e.decode(n))yield t;for(let t of e.flush())yield t}return new tg(async function*(){if(r)throw new d("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let t=!1;try{for await(let e of s())!t&&e&&(yield JSON.parse(e));t=!0}catch(t){if(c(t))return;throw t}finally{t||e.abort()}},e,n)}[(eA=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let t=[],e=[],n=this.iterator(),r=r=>({next:()=>{if(0===r.length){let r=n.next();t.push(r),e.push(r)}return r.shift()}});return[new tg(()=>r(t),this.controller,l(this,eA,"f")),new tg(()=>r(e),this.controller,l(this,eA,"f"))]}toReadableStream(){let t;let e=this;return H({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{let{value:n,done:r}=await t.next();if(r)return e.close();let s=ts(JSON.stringify(n)+"\n");e.enqueue(s)}catch(t){e.error(t)}},async cancel(){await t.return?.()}})}}async function*tm(t,e){if(!t.body){if(e.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new d("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new d("Attempted to iterate over a response with no body")}let n=new tw,r=new ta;for await(let e of ty(z(t.body)))for(let t of r.decode(e)){let e=n.decode(t);e&&(yield e)}for(let t of r.flush()){let e=n.decode(t);e&&(yield e)}}async function*ty(t){let e=new Uint8Array;for await(let n of t){let t;if(null==n)continue;let r=n instanceof ArrayBuffer?new Uint8Array(n):"string"==typeof n?ts(n):n,s=new Uint8Array(e.length+r.length);for(s.set(e),s.set(r,e.length),e=s;-1!==(t=function(t){for(let e=0;e<t.length-1;e++){if(10===t[e]&&10===t[e+1]||13===t[e]&&13===t[e+1])return e+2;if(13===t[e]&&10===t[e+1]&&e+3<t.length&&13===t[e+2]&&10===t[e+3])return e+4}return -1}(e));)yield e.slice(0,t),e=e.slice(t)}e.length>0&&(yield e)}class tw{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;let t={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],t}if(this.chunks.push(t),t.startsWith(":"))return null;let[e,n,r]=function(t,e){let n=t.indexOf(":");return -1!==n?[t.substring(0,n),":",t.substring(n+e.length)]:[t,"",""]}(t,":");return r.startsWith(" ")&&(r=r.substring(1)),"event"===e?this.event=r:"data"===e&&this.data.push(r),null}}async function t_(t,e){let{response:n,requestLogID:r,retryOfRequestLogID:s,startTime:i}=e,a=await (async()=>{if(e.options.stream)return(tf(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass)?e.options.__streamClass.fromSSEResponse(n,e.controller,t):tg.fromSSEResponse(n,e.controller,t);if(204===n.status)return null;if(e.options.__binaryResponse)return n;let r=n.headers.get("content-type"),s=r?.split(";")[0]?.trim();return s?.includes("application/json")||s?.endsWith("+json")?tb(await n.json(),n):await n.text()})();return tf(t).debug(`[${r}] response parsed`,tp({retryOfRequestLogID:s,url:n.url,status:n.status,body:a,durationMs:Date.now()-i})),a}function tb(t,e){return!t||"object"!=typeof t||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class tv extends Promise{constructor(t,e,n=t_){super(t=>{t(null)}),this.responsePromise=e,this.parseResponse=n,ek.set(this,void 0),o(this,ek,t,"f")}_thenUnwrap(t){return new tv(l(this,ek,"f"),this.responsePromise,async(e,n)=>tb(t(await this.parseResponse(e,n),n),n.response))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){let[t,e]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:e,request_id:e.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(l(this,ek,"f"),t))),this.parsedPromise}then(t,e){return this.parse().then(t,e)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}ek=new WeakMap;class tx{constructor(t,e,n,r){eO.set(this,void 0),o(this,eO,t,"f"),this.options=r,this.response=e,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let t=this.nextPageRequestOptions();if(!t)throw new d("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await l(this,eO,"f").requestAPIList(this.constructor,t)}async *iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async *[(eO=new WeakMap,Symbol.asyncIterator)](){for await(let t of this.iterPages())for(let e of t.getPaginatedItems())yield e}}class tS extends tv{constructor(t,e,n){super(t,e,async(t,e)=>new n(t,e.response,await t_(t,e),e.options))}async *[Symbol.asyncIterator](){for await(let t of(await this))yield t}}class tA extends tx{constructor(t,e,n,r){super(t,e,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tk extends tx{constructor(t,e,n,r){super(t,e,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let t=this.getPaginatedItems(),e=t[t.length-1]?.id;return e?{...this.options,query:{...R(this.options.query),after:e}}:null}}class tO extends tx{constructor(t,e,n,r){super(t,e,n,r),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let t=this.last_id;return t?{...this.options,query:{...R(this.options.query),after:t}}:null}}let tE=()=>{if("undefined"==typeof File){let{process:t}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof t?.versions?.node&&20>parseInt(t.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tC(t,e,n){return tE(),new File(t,e??"unknown_file",n)}function tP(t){return("object"==typeof t&&null!==t&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}let tI=t=>null!=t&&"object"==typeof t&&"function"==typeof t[Symbol.asyncIterator],t$=async(t,e)=>tM(t.body)?{...t,body:await tN(t.body,e)}:t,tR=async(t,e)=>({...t,body:await tN(t.body,e)}),tT=new WeakMap,tN=async(t,e)=>{if(!await function(t){let e="function"==typeof t?t:t.fetch,n=tT.get(e);if(n)return n;let r=(async()=>{try{let t="Response"in e?e.Response:(await e("data:,")).constructor,n=new FormData;if(n.toString()===await new t(n).text())return!1;return!0}catch{return!0}})();return tT.set(e,r),r}(e))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let n=new FormData;return await Promise.all(Object.entries(t||{}).map(([t,e])=>tU(n,t,e))),n},tD=t=>t instanceof Blob&&"name"in t,tW=t=>"object"==typeof t&&null!==t&&(t instanceof Response||tI(t)||tD(t)),tM=t=>{if(tW(t))return!0;if(Array.isArray(t))return t.some(tM);if(t&&"object"==typeof t){for(let e in t)if(tM(t[e]))return!0}return!1},tU=async(t,e,n)=>{if(void 0!==n){if(null==n)throw TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)t.append(e,String(n));else if(n instanceof Response)t.append(e,tC([await n.blob()],tP(n)));else if(tI(n))t.append(e,tC([await new Response(q(n)).blob()],tP(n)));else if(tD(n))t.append(e,n,tP(n));else if(Array.isArray(n))await Promise.all(n.map(n=>tU(t,e+"[]",n)));else if("object"==typeof n)await Promise.all(Object.entries(n).map(([n,r])=>tU(t,`${e}[${n}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}},tL=t=>null!=t&&"object"==typeof t&&"number"==typeof t.size&&"string"==typeof t.type&&"function"==typeof t.text&&"function"==typeof t.slice&&"function"==typeof t.arrayBuffer,tF=t=>null!=t&&"object"==typeof t&&"string"==typeof t.name&&"number"==typeof t.lastModified&&tL(t),tj=t=>null!=t&&"object"==typeof t&&"string"==typeof t.url&&"function"==typeof t.blob;async function tB(t,e,n){if(tE(),tF(t=await t))return t instanceof File?t:tC([await t.arrayBuffer()],t.name);if(tj(t)){let r=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),tC(await tH(r),e,n)}let r=await tH(t);if(e||(e=tP(t)),!n?.type){let t=r.find(t=>"object"==typeof t&&"type"in t&&t.type);"string"==typeof t&&(n={...n,type:t})}return tC(r,e,n)}async function tH(t){let e=[];if("string"==typeof t||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(tL(t))e.push(t instanceof Blob?t:await t.arrayBuffer());else if(tI(t))for await(let n of t)e.push(...await tH(n));else{let e=t?.constructor?.name;throw Error(`Unexpected data type: ${typeof t}${e?`; constructor: ${e}`:""}${function(t){if("object"!=typeof t||null===t)return"";let e=Object.getOwnPropertyNames(t);return`; props: [${e.map(t=>`"${t}"`).join(", ")}]`}(t)}`)}return e}class tq{constructor(t){this._client=t}}function tz(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let tK=Object.freeze(Object.create(null)),tX=((t=tz)=>function(e,...n){let r;if(1===e.length)return e[0];let s=!1,i=[],a=e.reduce((e,r,a)=>{/[?#]/.test(r)&&(s=!0);let o=n[a],l=(s?encodeURIComponent:t)(""+o);return a!==n.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??tK)??tK)?.toString)&&(l=o+"",i.push({start:e.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),e+r+(a===n.length?"":l)},""),o=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(o));)i.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(i.sort((t,e)=>t.start-e.start),i.length>0){let t=0,e=i.reduce((e,n)=>{let r=" ".repeat(n.start-t),s="^".repeat(n.length);return t=n.start+n.length,e+r+s},"");throw new d(`Path parameters result in path with invalid segments:
${i.map(t=>t.error).join("\n")}
${a}
${e}`)}return a})(tz);class tJ extends tq{list(t,e={},n){return this._client.getAPIList(tX`/chat/completions/${t}/messages`,tk,{query:e,...n})}}function tV(t){return void 0!==t&&"function"in t&&void 0!==t.function}function tY(t){return t?.$brand==="auto-parseable-response-format"}function tG(t){return t?.$brand==="auto-parseable-tool"}function tZ(t,e){let n=t.choices.map(t=>{var n;if("length"===t.finish_reason)throw new k;if("content_filter"===t.finish_reason)throw new O;return t0(t.message.tool_calls),{...t,message:{...t.message,...t.message.tool_calls?{tool_calls:t.message.tool_calls?.map(t=>(function(t,e){let n=t.tools?.find(t=>tV(t)&&t.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:tG(n)?n.$parseRaw(e.function.arguments):n?.function.strict?JSON.parse(e.function.arguments):null}}})(e,t))??void 0}:void 0,parsed:t.message.content&&!t.message.refusal?(n=t.message.content,e.response_format?.type!=="json_schema"?null:e.response_format?.type==="json_schema"?"$parseRaw"in e.response_format?e.response_format.$parseRaw(n):JSON.parse(n):null):null}}});return{...t,choices:n}}function tQ(t){return!!tY(t.response_format)||(t.tools?.some(t=>tG(t)||"function"===t.type&&!0===t.function.strict)??!1)}function t0(t){for(let e of t||[])if("function"!==e.type)throw new d(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}let t1=t=>t?.role==="assistant",t2=t=>t?.role==="tool";class t5{constructor(){eE.add(this),this.controller=new AbortController,eC.set(this,void 0),eP.set(this,()=>{}),eI.set(this,()=>{}),e$.set(this,void 0),eR.set(this,()=>{}),eT.set(this,()=>{}),eN.set(this,{}),eD.set(this,!1),eW.set(this,!1),eM.set(this,!1),eU.set(this,!1),o(this,eC,new Promise((t,e)=>{o(this,eP,t,"f"),o(this,eI,e,"f")}),"f"),o(this,e$,new Promise((t,e)=>{o(this,eR,t,"f"),o(this,eT,e,"f")}),"f"),l(this,eC,"f").catch(()=>{}),l(this,e$,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},l(this,eE,"m",eL).bind(this))},0)}_connected(){this.ended||(l(this,eP,"f").call(this),this._emit("connect"))}get ended(){return l(this,eD,"f")}get errored(){return l(this,eW,"f")}get aborted(){return l(this,eM,"f")}abort(){this.controller.abort()}on(t,e){return(l(this,eN,"f")[t]||(l(this,eN,"f")[t]=[])).push({listener:e}),this}off(t,e){let n=l(this,eN,"f")[t];if(!n)return this;let r=n.findIndex(t=>t.listener===e);return r>=0&&n.splice(r,1),this}once(t,e){return(l(this,eN,"f")[t]||(l(this,eN,"f")[t]=[])).push({listener:e,once:!0}),this}emitted(t){return new Promise((e,n)=>{o(this,eU,!0,"f"),"error"!==t&&this.once("error",n),this.once(t,e)})}async done(){o(this,eU,!0,"f"),await l(this,e$,"f")}_emit(t,...e){if(l(this,eD,"f"))return;"end"===t&&(o(this,eD,!0,"f"),l(this,eR,"f").call(this));let n=l(this,eN,"f")[t];if(n&&(l(this,eN,"f")[t]=n.filter(t=>!t.once),n.forEach(({listener:t})=>t(...e))),"abort"===t){let t=e[0];l(this,eU,"f")||n?.length||Promise.reject(t),l(this,eI,"f").call(this,t),l(this,eT,"f").call(this,t),this._emit("end");return}if("error"===t){let t=e[0];l(this,eU,"f")||n?.length||Promise.reject(t),l(this,eI,"f").call(this,t),l(this,eT,"f").call(this,t),this._emit("end")}}_emitFinal(){}}eC=new WeakMap,eP=new WeakMap,eI=new WeakMap,e$=new WeakMap,eR=new WeakMap,eT=new WeakMap,eN=new WeakMap,eD=new WeakMap,eW=new WeakMap,eM=new WeakMap,eU=new WeakMap,eE=new WeakSet,eL=function(t){if(o(this,eW,!0,"f"),t instanceof Error&&"AbortError"===t.name&&(t=new p),t instanceof p)return o(this,eM,!0,"f"),this._emit("abort",t);if(t instanceof d)return this._emit("error",t);if(t instanceof Error){let e=new d(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new d(String(t)))};class t8 extends t5{constructor(){super(...arguments),eF.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(t){this._chatCompletions.push(t),this._emit("chatCompletion",t);let e=t.choices[0]?.message;return e&&this._addMessage(e),t}_addMessage(t,e=!0){if("content"in t||(t.content=null),this.messages.push(t),e){if(this._emit("message",t),t2(t)&&t.content)this._emit("functionToolCallResult",t.content);else if(t1(t)&&t.tool_calls)for(let e of t.tool_calls)"function"===e.type&&this._emit("functionToolCall",e.function)}}async finalChatCompletion(){await this.done();let t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new d("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),l(this,eF,"m",ej).call(this)}async finalMessage(){return await this.done(),l(this,eF,"m",eB).call(this)}async finalFunctionToolCall(){return await this.done(),l(this,eF,"m",eH).call(this)}async finalFunctionToolCallResult(){return await this.done(),l(this,eF,"m",eq).call(this)}async totalUsage(){return await this.done(),l(this,eF,"m",ez).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);let e=l(this,eF,"m",eB).call(this);e&&this._emit("finalMessage",e);let n=l(this,eF,"m",ej).call(this);n&&this._emit("finalContent",n);let r=l(this,eF,"m",eH).call(this);r&&this._emit("finalFunctionToolCall",r);let s=l(this,eF,"m",eq).call(this);null!=s&&this._emit("finalFunctionToolCallResult",s),this._chatCompletions.some(t=>t.usage)&&this._emit("totalUsage",l(this,eF,"m",ez).call(this))}async _createChatCompletion(t,e,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),l(this,eF,"m",eK).call(this,e);let s=await t.chat.completions.create({...e,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(tZ(s,e))}async _runChatCompletion(t,e,n){for(let t of e.messages)this._addMessage(t,!1);return await this._createChatCompletion(t,e,n)}async _runTools(t,e,n){let r="tool",{tool_choice:s="auto",stream:i,...a}=e,o="string"!=typeof s&&"function"===s.type&&s?.function?.name,{maxChatCompletions:h=10}=n||{},c=e.tools.map(t=>{if(tG(t)){if(!t.$callback)throw new d("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:t.$callback,name:t.function.name,description:t.function.description||"",parameters:t.function.parameters,parse:t.$parseRaw,strict:!0}}}return t}),u={};for(let t of c)"function"===t.type&&(u[t.function.name||t.function.function.name]=t.function);let f="tools"in e?c.map(t=>"function"===t.type?{type:"function",function:{name:t.function.name||t.function.function.name,parameters:t.function.parameters,description:t.function.description,strict:t.function.strict}}:t):void 0;for(let t of e.messages)this._addMessage(t,!1);for(let e=0;e<h;++e){let e=await this._createChatCompletion(t,{...a,tool_choice:s,tools:f,messages:[...this.messages]},n),i=e.choices[0]?.message;if(!i)throw new d("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let t of i.tool_calls){let e;if("function"!==t.type)continue;let n=t.id,{name:s,arguments:i}=t.function,a=u[s];if(a){if(o&&o!==s){let t=`Invalid tool_call: ${JSON.stringify(s)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:r,tool_call_id:n,content:t});continue}}else{let t=`Invalid tool_call: ${JSON.stringify(s)}. Available options are: ${Object.keys(u).map(t=>JSON.stringify(t)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:n,content:t});continue}try{e="function"==typeof a.parse?await a.parse(i):i}catch(e){let t=e instanceof Error?e.message:String(e);this._addMessage({role:r,tool_call_id:n,content:t});continue}let h=await a.function(e,this),c=l(this,eF,"m",eX).call(this,h);if(this._addMessage({role:r,tool_call_id:n,content:c}),o)return}}}}eF=new WeakSet,ej=function(){return l(this,eF,"m",eB).call(this).content??null},eB=function(){let t=this.messages.length;for(;t-- >0;){let e=this.messages[t];if(t1(e))return{...e,content:e.content??null,refusal:e.refusal??null}}throw new d("stream ended without producing a ChatCompletionMessage with role=assistant")},eH=function(){for(let t=this.messages.length-1;t>=0;t--){let e=this.messages[t];if(t1(e)&&e?.tool_calls?.length)return e.tool_calls.filter(t=>"function"===t.type).at(-1)?.function}},eq=function(){for(let t=this.messages.length-1;t>=0;t--){let e=this.messages[t];if(t2(e)&&null!=e.content&&"string"==typeof e.content&&this.messages.some(t=>"assistant"===t.role&&t.tool_calls?.some(t=>"function"===t.type&&t.id===e.tool_call_id)))return e.content}},ez=function(){let t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:e}of this._chatCompletions)e&&(t.completion_tokens+=e.completion_tokens,t.prompt_tokens+=e.prompt_tokens,t.total_tokens+=e.total_tokens);return t},eK=function(t){if(null!=t.n&&t.n>1)throw new d("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},eX=function(t){return"string"==typeof t?t:void 0===t?"undefined":JSON.stringify(t)};class t3 extends t8{static runTools(t,e,n){let r=new t3,s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(t,e,s)),r}_addMessage(t,e=!0){super._addMessage(t,e),t1(t)&&t.content&&this._emit("content",t.content)}}let t6={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class t4 extends Error{}class t7 extends Error{}let t9=(t,e)=>{let n=t.length,r=0,s=t=>{throw new t4(`${t} at position ${r}`)},i=t=>{throw new t7(`${t} at position ${r}`)},a=()=>(u(),r>=n&&s("Unexpected end of input"),'"'===t[r])?o():"{"===t[r]?l():"["===t[r]?h():"null"===t.substring(r,r+4)||t6.NULL&e&&n-r<4&&"null".startsWith(t.substring(r))?(r+=4,null):"true"===t.substring(r,r+4)||t6.BOOL&e&&n-r<4&&"true".startsWith(t.substring(r))?(r+=4,!0):"false"===t.substring(r,r+5)||t6.BOOL&e&&n-r<5&&"false".startsWith(t.substring(r))?(r+=5,!1):"Infinity"===t.substring(r,r+8)||t6.INFINITY&e&&n-r<8&&"Infinity".startsWith(t.substring(r))?(r+=8,1/0):"-Infinity"===t.substring(r,r+9)||t6.MINUS_INFINITY&e&&1<n-r&&n-r<9&&"-Infinity".startsWith(t.substring(r))?(r+=9,-1/0):"NaN"===t.substring(r,r+3)||t6.NAN&e&&n-r<3&&"NaN".startsWith(t.substring(r))?(r+=3,NaN):c(),o=()=>{let a=r,o=!1;for(r++;r<n&&('"'!==t[r]||o&&"\\"===t[r-1]);)o="\\"===t[r]&&!o,r++;if('"'==t.charAt(r))try{return JSON.parse(t.substring(a,++r-Number(o)))}catch(t){i(String(t))}else if(t6.STR&e)try{return JSON.parse(t.substring(a,r-Number(o))+'"')}catch(e){return JSON.parse(t.substring(a,t.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,u();let i={};try{for(;"}"!==t[r];){if(u(),r>=n&&t6.OBJ&e)return i;let s=o();u(),r++;try{let t=a();Object.defineProperty(i,s,{value:t,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(t6.OBJ&e)return i;throw t}u(),","===t[r]&&r++}}catch(t){if(t6.OBJ&e)return i;s("Expected '}' at end of object")}return r++,i},h=()=>{r++;let n=[];try{for(;"]"!==t[r];)n.push(a()),u(),","===t[r]&&r++}catch(t){if(t6.ARR&e)return n;s("Expected ']' at end of array")}return r++,n},c=()=>{if(0===r){"-"===t&&t6.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t)}catch(n){if(t6.NUM&e)try{if("."===t[t.length-1])return JSON.parse(t.substring(0,t.lastIndexOf(".")));return JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch(t){}i(String(n))}}let a=r;for("-"===t[r]&&r++;t[r]&&!",]}".includes(t[r]);)r++;r!=n||t6.NUM&e||s("Unterminated number literal");try{return JSON.parse(t.substring(a,r))}catch(n){"-"===t.substring(a,r)&&t6.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t.substring(a,t.lastIndexOf("e")))}catch(t){i(String(t))}}},u=()=>{for(;r<n&&" \n\r	".includes(t[r]);)r++};return a()},et=t=>(function(t,e=t6.ALL){if("string"!=typeof t)throw TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw Error(`${t} is empty`);return t9(t.trim(),e)})(t,t6.ALL^t6.NUM);class ee extends t8{constructor(t){super(),eJ.add(this),eV.set(this,void 0),eY.set(this,void 0),eG.set(this,void 0),o(this,eV,t,"f"),o(this,eY,[],"f")}get currentChatCompletionSnapshot(){return l(this,eG,"f")}static fromReadableStream(t){let e=new ee(null);return e._run(()=>e._fromReadableStream(t)),e}static createChatCompletion(t,e,n){let r=new ee(e);return r._run(()=>r._runChatCompletion(t,{...e,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(t,e,n){super._createChatCompletion;let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),l(this,eJ,"m",eZ).call(this);let s=await t.chat.completions.create({...e,stream:!0},{...n,signal:this.controller.signal});for await(let t of(this._connected(),s))l(this,eJ,"m",e0).call(this,t);if(s.controller.signal?.aborted)throw new p;return this._addChatCompletion(l(this,eJ,"m",e5).call(this))}async _fromReadableStream(t,e){let n;let r=e?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),l(this,eJ,"m",eZ).call(this),this._connected();let s=tg.fromReadableStream(t,this.controller);for await(let t of s)n&&n!==t.id&&this._addChatCompletion(l(this,eJ,"m",e5).call(this)),l(this,eJ,"m",e0).call(this,t),n=t.id;if(s.controller.signal?.aborted)throw new p;return this._addChatCompletion(l(this,eJ,"m",e5).call(this))}[(eV=new WeakMap,eY=new WeakMap,eG=new WeakMap,eJ=new WeakSet,eZ=function(){this.ended||o(this,eG,void 0,"f")},eQ=function(t){let e=l(this,eY,"f")[t.index];return e||(e={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},l(this,eY,"f")[t.index]=e),e},e0=function(t){if(this.ended)return;let e=l(this,eJ,"m",e3).call(this,t);for(let n of(this._emit("chunk",t,e),t.choices)){let t=e.choices[n.index];null!=n.delta.content&&t.message?.role==="assistant"&&t.message?.content&&(this._emit("content",n.delta.content,t.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:t.message.content,parsed:t.message.parsed})),null!=n.delta.refusal&&t.message?.role==="assistant"&&t.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:t.message.refusal}),n.logprobs?.content!=null&&t.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:t.logprobs?.content??[]}),n.logprobs?.refusal!=null&&t.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:t.logprobs?.refusal??[]});let r=l(this,eJ,"m",eQ).call(this,t);for(let e of(t.finish_reason&&(l(this,eJ,"m",e2).call(this,t),null!=r.current_tool_call_index&&l(this,eJ,"m",e1).call(this,t,r.current_tool_call_index)),n.delta.tool_calls??[]))r.current_tool_call_index!==e.index&&(l(this,eJ,"m",e2).call(this,t),null!=r.current_tool_call_index&&l(this,eJ,"m",e1).call(this,t,r.current_tool_call_index)),r.current_tool_call_index=e.index;for(let e of n.delta.tool_calls??[]){let n=t.message.tool_calls?.[e.index];n?.type&&(n?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:n.function?.name,index:e.index,arguments:n.function.arguments,parsed_arguments:n.function.parsed_arguments,arguments_delta:e.function?.arguments??""}):n?.type)}}},e1=function(t,e){if(l(this,eJ,"m",eQ).call(this,t).done_tool_calls.has(e))return;let n=t.message.tool_calls?.[e];if(!n)throw Error("no tool call snapshot");if(!n.type)throw Error("tool call snapshot missing `type`");if("function"===n.type){let t=l(this,eV,"f")?.tools?.find(t=>tV(t)&&t.function.name===n.function.name);this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:e,arguments:n.function.arguments,parsed_arguments:tG(t)?t.$parseRaw(n.function.arguments):t?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},e2=function(t){let e=l(this,eJ,"m",eQ).call(this,t);if(t.message.content&&!e.content_done){e.content_done=!0;let n=l(this,eJ,"m",e8).call(this);this._emit("content.done",{content:t.message.content,parsed:n?n.$parseRaw(t.message.content):null})}t.message.refusal&&!e.refusal_done&&(e.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!e.logprobs_content_done&&(e.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!e.logprobs_refusal_done&&(e.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},e5=function(){if(this.ended)throw new d("stream has ended, this shouldn't happen");let t=l(this,eG,"f");if(!t)throw new d("request ended without sending any chunks");return o(this,eG,void 0,"f"),o(this,eY,[],"f"),function(t,e){var n;let{id:r,choices:s,created:i,model:a,system_fingerprint:o,...l}=t;return n={...l,id:r,choices:s.map(({message:e,finish_reason:n,index:r,logprobs:s,...i})=>{if(!n)throw new d(`missing finish_reason for choice ${r}`);let{content:a=null,function_call:o,tool_calls:l,...h}=e,c=e.role;if(!c)throw new d(`missing role for choice ${r}`);if(o){let{arguments:t,name:l}=o;if(null==t)throw new d(`missing function_call.arguments for choice ${r}`);if(!l)throw new d(`missing function_call.name for choice ${r}`);return{...i,message:{content:a,function_call:{arguments:t,name:l},role:c,refusal:e.refusal??null},finish_reason:n,index:r,logprobs:s}}return l?{...i,index:r,finish_reason:n,logprobs:s,message:{...h,role:c,content:a,refusal:e.refusal??null,tool_calls:l.map((e,n)=>{let{function:s,type:i,id:a,...o}=e,{arguments:l,name:h,...c}=s||{};if(null==a)throw new d(`missing choices[${r}].tool_calls[${n}].id
${en(t)}`);if(null==i)throw new d(`missing choices[${r}].tool_calls[${n}].type
${en(t)}`);if(null==h)throw new d(`missing choices[${r}].tool_calls[${n}].function.name
${en(t)}`);if(null==l)throw new d(`missing choices[${r}].tool_calls[${n}].function.arguments
${en(t)}`);return{...o,id:a,type:i,function:{...c,name:h,arguments:l}}})}}:{...i,message:{...h,content:a,role:c,refusal:e.refusal??null},finish_reason:n,index:r,logprobs:s}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},e&&tQ(e)?tZ(n,e):{...n,choices:n.choices.map(t=>(t0(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}}(t,l(this,eV,"f"))},e8=function(){let t=l(this,eV,"f")?.response_format;return tY(t)?t:null},e3=function(t){var e,n,r,s;let i=l(this,eG,"f"),{choices:a,...h}=t;for(let{delta:a,finish_reason:c,index:u,logprobs:d=null,...f}of(i?Object.assign(i,h):i=o(this,eG,{...h,choices:[]},"f"),t.choices)){let t=i.choices[u];if(t||(t=i.choices[u]={finish_reason:c,index:u,message:{},logprobs:d,...f}),d){if(t.logprobs){let{content:r,refusal:s,...i}=d;Object.assign(t.logprobs,i),r&&((e=t.logprobs).content??(e.content=[]),t.logprobs.content.push(...r)),s&&((n=t.logprobs).refusal??(n.refusal=[]),t.logprobs.refusal.push(...s))}else t.logprobs=Object.assign({},d)}if(c&&(t.finish_reason=c,l(this,eV,"f")&&tQ(l(this,eV,"f")))){if("length"===c)throw new k;if("content_filter"===c)throw new O}if(Object.assign(t,f),!a)continue;let{content:o,refusal:h,function_call:p,role:g,tool_calls:m,...y}=a;if(Object.assign(t.message,y),h&&(t.message.refusal=(t.message.refusal||"")+h),g&&(t.message.role=g),p&&(t.message.function_call?(p.name&&(t.message.function_call.name=p.name),p.arguments&&((r=t.message.function_call).arguments??(r.arguments=""),t.message.function_call.arguments+=p.arguments)):t.message.function_call=p),o&&(t.message.content=(t.message.content||"")+o,!t.message.refusal&&l(this,eJ,"m",e8).call(this)&&(t.message.parsed=et(t.message.content))),m)for(let{index:e,id:n,type:r,function:i,...a}of(t.message.tool_calls||(t.message.tool_calls=[]),m)){let o=(s=t.message.tool_calls)[e]??(s[e]={});Object.assign(o,a),n&&(o.id=n),r&&(o.type=r),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(t,e){if(!t||!("tools"in t)||!t.tools)return!1;let n=t.tools?.find(t=>tV(t)&&t.function?.name===e.function.name);return tV(n)&&(tG(n)||n?.function.strict||!1)}(l(this,eV,"f"),o)&&(o.function.parsed_arguments=et(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let t=[],e=[],n=!1;return this.on("chunk",n=>{let r=e.shift();r?r.resolve(n):t.push(n)}),this.on("end",()=>{for(let t of(n=!0,e))t.resolve(void 0);e.length=0}),this.on("abort",t=>{for(let r of(n=!0,e))r.reject(t);e.length=0}),this.on("error",t=>{for(let r of(n=!0,e))r.reject(t);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((t,n)=>e.push({resolve:t,reject:n})).then(t=>t?{value:t,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tg(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function en(t){return JSON.stringify(t)}class er extends ee{static fromReadableStream(t){let e=new er(null);return e._run(()=>e._fromReadableStream(t)),e}static runTools(t,e,n){let r=new er(e),s={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(t,e,s)),r}}class es extends tq{constructor(){super(...arguments),this.messages=new tJ(this._client)}create(t,e){return this._client.post("/chat/completions",{body:t,...e,stream:t.stream??!1})}retrieve(t,e){return this._client.get(tX`/chat/completions/${t}`,e)}update(t,e,n){return this._client.post(tX`/chat/completions/${t}`,{body:e,...n})}list(t={},e){return this._client.getAPIList("/chat/completions",tk,{query:t,...e})}delete(t,e){return this._client.delete(tX`/chat/completions/${t}`,e)}parse(t,e){return!function(t){for(let e of t??[]){if("function"!==e.type)throw new d(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(!0!==e.function.strict)throw new d(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(t.tools),this._client.chat.completions.create(t,{...e,headers:{...e?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(e=>tZ(e,t))}runTools(t,e){return t.stream?er.runTools(this._client,t,e):t3.runTools(this._client,t,e)}stream(t,e){return ee.createChatCompletion(this._client,t,e)}}es.Messages=tJ;class ei extends tq{constructor(){super(...arguments),this.completions=new es(this._client)}}ei.Completions=es;let ea=Symbol("brand.privateNullableHeaders"),eo=t=>{let e=new Headers,n=new Set;for(let r of t){let t=new Set;for(let[s,i]of function*(t){let e;if(!t)return;if(ea in t){let{values:e,nulls:n}=t;for(let t of(yield*e.entries(),n))yield[t,null];return}let n=!1;for(let r of(t instanceof Headers?e=t.entries():$(t)?e=t:(n=!0,e=Object.entries(t??{})),e)){let t=r[0];if("string"!=typeof t)throw TypeError("expected header name to be a string");let e=$(r[1])?r[1]:[r[1]],s=!1;for(let r of e)void 0!==r&&(n&&!s&&(s=!0,yield[t,null]),yield[t,r])}}(r)){let r=s.toLowerCase();t.has(r)||(e.delete(s),t.add(r)),null===i?(e.delete(s),n.add(r)):(e.append(s,i),n.delete(r))}}return{[ea]:!0,values:e,nulls:n}};class el extends tq{create(t,e){return this._client.post("/audio/speech",{body:t,...e,headers:eo([{Accept:"application/octet-stream"},e?.headers]),__binaryResponse:!0})}}class eh extends tq{create(t,e){return this._client.post("/audio/transcriptions",tR({body:t,...e,stream:t.stream??!1,__metadata:{model:t.model}},this._client))}}class ec extends tq{create(t,e){return this._client.post("/audio/translations",tR({body:t,...e,__metadata:{model:t.model}},this._client))}}class eu extends tq{constructor(){super(...arguments),this.transcriptions=new eh(this._client),this.translations=new ec(this._client),this.speech=new el(this._client)}}eu.Transcriptions=eh,eu.Translations=ec,eu.Speech=el;class ed extends tq{create(t,e){return this._client.post("/batches",{body:t,...e})}retrieve(t,e){return this._client.get(tX`/batches/${t}`,e)}list(t={},e){return this._client.getAPIList("/batches",tk,{query:t,...e})}cancel(t,e){return this._client.post(tX`/batches/${t}/cancel`,e)}}class ef extends tq{create(t,e){return this._client.post("/assistants",{body:t,...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}retrieve(t,e){return this._client.get(tX`/assistants/${t}`,{...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}update(t,e,n){return this._client.post(tX`/assistants/${t}`,{body:e,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t={},e){return this._client.getAPIList("/assistants",tk,{query:t,...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}delete(t,e){return this._client.delete(tX`/assistants/${t}`,{...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}}class ep extends tq{create(t,e){return this._client.post("/realtime/sessions",{body:t,...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}}class eg extends tq{create(t,e){return this._client.post("/realtime/transcription_sessions",{body:t,...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}}class em extends tq{constructor(){super(...arguments),this.sessions=new ep(this._client),this.transcriptionSessions=new eg(this._client)}}em.Sessions=ep,em.TranscriptionSessions=eg;class ey extends tq{create(t,e){return this._client.post("/chatkit/sessions",{body:t,...e,headers:eo([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}cancel(t,e){return this._client.post(tX`/chatkit/sessions/${t}/cancel`,{...e,headers:eo([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}}class ew extends tq{retrieve(t,e){return this._client.get(tX`/chatkit/threads/${t}`,{...e,headers:eo([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}list(t={},e){return this._client.getAPIList("/chatkit/threads",tO,{query:t,...e,headers:eo([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}delete(t,e){return this._client.delete(tX`/chatkit/threads/${t}`,{...e,headers:eo([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}listItems(t,e={},n){return this._client.getAPIList(tX`/chatkit/threads/${t}/items`,tO,{query:e,...n,headers:eo([{"OpenAI-Beta":"chatkit_beta=v1"},n?.headers])})}}class e_ extends tq{constructor(){super(...arguments),this.sessions=new ey(this._client),this.threads=new ew(this._client)}}e_.Sessions=ey,e_.Threads=ew;class eb extends tq{create(t,e,n){return this._client.post(tX`/threads/${t}/messages`,{body:e,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(t,e,n){let{thread_id:r}=e;return this._client.get(tX`/threads/${r}/messages/${t}`,{...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(t,e,n){let{thread_id:r,...s}=e;return this._client.post(tX`/threads/${r}/messages/${t}`,{body:s,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t,e={},n){return this._client.getAPIList(tX`/threads/${t}/messages`,tk,{query:e,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(t,e,n){let{thread_id:r}=e;return this._client.delete(tX`/threads/${r}/messages/${t}`,{...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class ev extends tq{retrieve(t,e,n){let{thread_id:r,run_id:s,...i}=e;return this._client.get(tX`/threads/${r}/runs/${s}/steps/${t}`,{query:i,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t,e,n){let{thread_id:r,...s}=e;return this._client.getAPIList(tX`/threads/${r}/runs/${t}/steps`,tk,{query:s,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}var ex,eS,eA,ek,eO,eE,eC,eP,eI,e$,eR,eT,eN,eD,eW,eM,eU,eL,eF,ej,eB,eH,eq,ez,eK,eX,eJ,eV,eY,eG,eZ,eQ,e0,e1,e2,e5,e8,e3,e6,e4,e7,e9,nt,ne,nn,nr,ns,ni,na,no,nl,nh,nc,nu,nd,nf,np,ng,nm,ny,nw,n_,nb,nv,nx,nS,nA,nk,nO,nE,nC,nP,nI,n$,nR,nT,nN=n(96434).Buffer;let nD=t=>{if(void 0!==nN){let e=nN.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}{let e=atob(t),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.charCodeAt(t);return Array.from(new Float32Array(r.buffer))}},nW=t=>void 0!==globalThis.process?globalThis.process.env?.[t]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(t)?.trim():void 0;class nM extends t5{constructor(){super(...arguments),e6.add(this),e7.set(this,[]),e9.set(this,{}),nt.set(this,{}),ne.set(this,void 0),nn.set(this,void 0),nr.set(this,void 0),ns.set(this,void 0),ni.set(this,void 0),na.set(this,void 0),no.set(this,void 0),nl.set(this,void 0),nh.set(this,void 0)}[(e7=new WeakMap,e9=new WeakMap,nt=new WeakMap,ne=new WeakMap,nn=new WeakMap,nr=new WeakMap,ns=new WeakMap,ni=new WeakMap,na=new WeakMap,no=new WeakMap,nl=new WeakMap,nh=new WeakMap,e6=new WeakSet,Symbol.asyncIterator)](){let t=[],e=[],n=!1;return this.on("event",n=>{let r=e.shift();r?r.resolve(n):t.push(n)}),this.on("end",()=>{for(let t of(n=!0,e))t.resolve(void 0);e.length=0}),this.on("abort",t=>{for(let r of(n=!0,e))r.reject(t);e.length=0}),this.on("error",t=>{for(let r of(n=!0,e))r.reject(t);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((t,n)=>e.push({resolve:t,reject:n})).then(t=>t?{value:t,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){let e=new e4;return e._run(()=>e._fromReadableStream(t)),e}async _fromReadableStream(t,e){let n=e?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let r=tg.fromReadableStream(t,this.controller);for await(let t of r)l(this,e6,"m",nc).call(this,t);if(r.controller.signal?.aborted)throw new p;return this._addRun(l(this,e6,"m",nu).call(this))}toReadableStream(){return new tg(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,e,n,r){let s=new e4;return s._run(()=>s._runToolAssistantStream(t,e,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(t,e,n,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...n,stream:!0},a=await t.submitToolOutputs(e,i,{...r,signal:this.controller.signal});for await(let t of(this._connected(),a))l(this,e6,"m",nc).call(this,t);if(a.controller.signal?.aborted)throw new p;return this._addRun(l(this,e6,"m",nu).call(this))}static createThreadAssistantStream(t,e,n){let r=new e4;return r._run(()=>r._threadAssistantStream(t,e,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(t,e,n,r){let s=new e4;return s._run(()=>s._runAssistantStream(t,e,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return l(this,no,"f")}currentRun(){return l(this,nl,"f")}currentMessageSnapshot(){return l(this,ne,"f")}currentRunStepSnapshot(){return l(this,nh,"f")}async finalRunSteps(){return await this.done(),Object.values(l(this,e9,"f"))}async finalMessages(){return await this.done(),Object.values(l(this,nt,"f"))}async finalRun(){if(await this.done(),!l(this,nn,"f"))throw Error("Final run was not received.");return l(this,nn,"f")}async _createThreadAssistantStream(t,e,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let s={...e,stream:!0},i=await t.createAndRun(s,{...n,signal:this.controller.signal});for await(let t of(this._connected(),i))l(this,e6,"m",nc).call(this,t);if(i.controller.signal?.aborted)throw new p;return this._addRun(l(this,e6,"m",nu).call(this))}async _createAssistantStream(t,e,n,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...n,stream:!0},a=await t.create(e,i,{...r,signal:this.controller.signal});for await(let t of(this._connected(),a))l(this,e6,"m",nc).call(this,t);if(a.controller.signal?.aborted)throw new p;return this._addRun(l(this,e6,"m",nu).call(this))}static accumulateDelta(t,e){for(let[n,r]of Object.entries(e)){if(!t.hasOwnProperty(n)){t[n]=r;continue}let e=t[n];if(null==e||"index"===n||"type"===n){t[n]=r;continue}if("string"==typeof e&&"string"==typeof r)e+=r;else if("number"==typeof e&&"number"==typeof r)e+=r;else if(T(e)&&T(r))e=this.accumulateDelta(e,r);else if(Array.isArray(e)&&Array.isArray(r)){if(e.every(t=>"string"==typeof t||"number"==typeof t)){e.push(...r);continue}for(let t of r){if(!T(t))throw Error(`Expected array delta entry to be an object but got: ${t}`);let n=t.index;if(null==n)throw console.error(t),Error("Expected array delta entry to have an `index` property");if("number"!=typeof n)throw Error(`Expected array delta entry \`index\` property to be a number but got ${n}`);let r=e[n];null==r?e.push(t):e[n]=this.accumulateDelta(r,t)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${e}`);t[n]=e}return t}_addRun(t){return t}async _threadAssistantStream(t,e,n){return await this._createThreadAssistantStream(e,t,n)}async _runAssistantStream(t,e,n,r){return await this._createAssistantStream(e,t,n,r)}async _runToolAssistantStream(t,e,n,r){return await this._createToolAssistantStream(e,t,n,r)}}e4=nM,nc=function(t){if(!this.ended)switch(o(this,no,t,"f"),l(this,e6,"m",np).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":l(this,e6,"m",nw).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":l(this,e6,"m",nf).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":l(this,e6,"m",nd).call(this,t);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},nu=function(){if(this.ended)throw new d("stream has ended, this shouldn't happen");if(!l(this,nn,"f"))throw Error("Final run has not been received");return l(this,nn,"f")},nd=function(t){let[e,n]=l(this,e6,"m",nm).call(this,t,l(this,ne,"f"));for(let t of(o(this,ne,e,"f"),l(this,nt,"f")[e.id]=e,n)){let n=e.content[t.index];n?.type=="text"&&this._emit("textCreated",n.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,e),t.data.delta.content)for(let n of t.data.delta.content){if("text"==n.type&&n.text){let t=n.text,r=e.content[n.index];if(r&&"text"==r.type)this._emit("textDelta",t,r.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(n.index!=l(this,nr,"f")){if(l(this,ns,"f"))switch(l(this,ns,"f").type){case"text":this._emit("textDone",l(this,ns,"f").text,l(this,ne,"f"));break;case"image_file":this._emit("imageFileDone",l(this,ns,"f").image_file,l(this,ne,"f"))}o(this,nr,n.index,"f")}o(this,ns,e.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==l(this,nr,"f")){let e=t.data.content[l(this,nr,"f")];if(e)switch(e.type){case"image_file":this._emit("imageFileDone",e.image_file,l(this,ne,"f"));break;case"text":this._emit("textDone",e.text,l(this,ne,"f"))}}l(this,ne,"f")&&this._emit("messageDone",t.data),o(this,ne,void 0,"f")}},nf=function(t){let e=l(this,e6,"m",ng).call(this,t);switch(o(this,nh,e,"f"),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":let n=t.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==e.step_details.type)for(let t of n.step_details.tool_calls)t.index==l(this,ni,"f")?this._emit("toolCallDelta",t,e.step_details.tool_calls[t.index]):(l(this,na,"f")&&this._emit("toolCallDone",l(this,na,"f")),o(this,ni,t.index,"f"),o(this,na,e.step_details.tool_calls[t.index],"f"),l(this,na,"f")&&this._emit("toolCallCreated",l(this,na,"f")));this._emit("runStepDelta",t.data.delta,e);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":o(this,nh,void 0,"f"),"tool_calls"==t.data.step_details.type&&l(this,na,"f")&&(this._emit("toolCallDone",l(this,na,"f")),o(this,na,void 0,"f")),this._emit("runStepDone",t.data,e)}},np=function(t){l(this,e7,"f").push(t),this._emit("event",t)},ng=function(t){switch(t.event){case"thread.run.step.created":return l(this,e9,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let e=l(this,e9,"f")[t.data.id];if(!e)throw Error("Received a RunStepDelta before creation of a snapshot");let n=t.data;if(n.delta){let r=e4.accumulateDelta(e,n.delta);l(this,e9,"f")[t.data.id]=r}return l(this,e9,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":l(this,e9,"f")[t.data.id]=t.data}if(l(this,e9,"f")[t.data.id])return l(this,e9,"f")[t.data.id];throw Error("No snapshot available")},nm=function(t,e){let n=[];switch(t.event){case"thread.message.created":return[t.data,n];case"thread.message.delta":if(!e)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=t.data;if(r.delta.content)for(let t of r.delta.content)if(t.index in e.content){let n=e.content[t.index];e.content[t.index]=l(this,e6,"m",ny).call(this,t,n)}else e.content[t.index]=t,n.push(t);return[e,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(e)return[e,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ny=function(t,e){return e4.accumulateDelta(e,t)},nw=function(t){switch(o(this,nl,t.data,"f"),t.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":o(this,nn,t.data,"f"),l(this,na,"f")&&(this._emit("toolCallDone",l(this,na,"f")),o(this,na,void 0,"f"))}};class nU extends tq{constructor(){super(...arguments),this.steps=new ev(this._client)}create(t,e,n){let{include:r,...s}=e;return this._client.post(tX`/threads/${t}/runs`,{query:{include:r},body:s,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:e.stream??!1})}retrieve(t,e,n){let{thread_id:r}=e;return this._client.get(tX`/threads/${r}/runs/${t}`,{...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(t,e,n){let{thread_id:r,...s}=e;return this._client.post(tX`/threads/${r}/runs/${t}`,{body:s,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t,e={},n){return this._client.getAPIList(tX`/threads/${t}/runs`,tk,{query:e,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(t,e,n){let{thread_id:r}=e;return this._client.post(tX`/threads/${r}/runs/${t}/cancel`,{...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(t,e,n){let r=await this.create(t,e,n);return await this.poll(r.id,{thread_id:t},n)}createAndStream(t,e,n){return nM.createAssistantStream(t,this._client.beta.threads.runs,e,n)}async poll(t,e,n){let r=eo([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:i}=await this.retrieve(t,e,{...n,headers:{...n?.headers,...r}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(n?.pollIntervalMs)a=n.pollIntervalMs;else{let t=i.headers.get("openai-poll-after-ms");if(t){let e=parseInt(t);isNaN(e)||(a=e)}}await W(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(t,e,n){return nM.createAssistantStream(t,this._client.beta.threads.runs,e,n)}submitToolOutputs(t,e,n){let{thread_id:r,...s}=e;return this._client.post(tX`/threads/${r}/runs/${t}/submit_tool_outputs`,{body:s,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:e.stream??!1})}async submitToolOutputsAndPoll(t,e,n){let r=await this.submitToolOutputs(t,e,n);return await this.poll(r.id,e,n)}submitToolOutputsStream(t,e,n){return nM.createToolAssistantStream(t,this._client.beta.threads.runs,e,n)}}nU.Steps=ev;class nL extends tq{constructor(){super(...arguments),this.runs=new nU(this._client),this.messages=new eb(this._client)}create(t={},e){return this._client.post("/threads",{body:t,...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}retrieve(t,e){return this._client.get(tX`/threads/${t}`,{...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}update(t,e,n){return this._client.post(tX`/threads/${t}`,{body:e,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(t,e){return this._client.delete(tX`/threads/${t}`,{...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}createAndRun(t,e){return this._client.post("/threads/runs",{body:t,...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers]),stream:t.stream??!1})}async createAndRunPoll(t,e){let n=await this.createAndRun(t,e);return await this.runs.poll(n.id,{thread_id:n.thread_id},e)}createAndRunStream(t,e){return nM.createThreadAssistantStream(t,this._client.beta.threads,e)}}nL.Runs=nU,nL.Messages=eb;class nF extends tq{constructor(){super(...arguments),this.realtime=new em(this._client),this.chatkit=new e_(this._client),this.assistants=new ef(this._client),this.threads=new nL(this._client)}}nF.Realtime=em,nF.ChatKit=e_,nF.Assistants=ef,nF.Threads=nL;class nj extends tq{create(t,e){return this._client.post("/completions",{body:t,...e,stream:t.stream??!1})}}class nB extends tq{retrieve(t,e,n){let{container_id:r}=e;return this._client.get(tX`/containers/${r}/files/${t}/content`,{...n,headers:eo([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}class nH extends tq{constructor(){super(...arguments),this.content=new nB(this._client)}create(t,e,n){return this._client.post(tX`/containers/${t}/files`,tR({body:e,...n},this._client))}retrieve(t,e,n){let{container_id:r}=e;return this._client.get(tX`/containers/${r}/files/${t}`,n)}list(t,e={},n){return this._client.getAPIList(tX`/containers/${t}/files`,tk,{query:e,...n})}delete(t,e,n){let{container_id:r}=e;return this._client.delete(tX`/containers/${r}/files/${t}`,{...n,headers:eo([{Accept:"*/*"},n?.headers])})}}nH.Content=nB;class nq extends tq{constructor(){super(...arguments),this.files=new nH(this._client)}create(t,e){return this._client.post("/containers",{body:t,...e})}retrieve(t,e){return this._client.get(tX`/containers/${t}`,e)}list(t={},e){return this._client.getAPIList("/containers",tk,{query:t,...e})}delete(t,e){return this._client.delete(tX`/containers/${t}`,{...e,headers:eo([{Accept:"*/*"},e?.headers])})}}nq.Files=nH;class nz extends tq{create(t,e,n){let{include:r,...s}=e;return this._client.post(tX`/conversations/${t}/items`,{query:{include:r},body:s,...n})}retrieve(t,e,n){let{conversation_id:r,...s}=e;return this._client.get(tX`/conversations/${r}/items/${t}`,{query:s,...n})}list(t,e={},n){return this._client.getAPIList(tX`/conversations/${t}/items`,tO,{query:e,...n})}delete(t,e,n){let{conversation_id:r}=e;return this._client.delete(tX`/conversations/${r}/items/${t}`,n)}}class nK extends tq{constructor(){super(...arguments),this.items=new nz(this._client)}create(t={},e){return this._client.post("/conversations",{body:t,...e})}retrieve(t,e){return this._client.get(tX`/conversations/${t}`,e)}update(t,e,n){return this._client.post(tX`/conversations/${t}`,{body:e,...n})}delete(t,e){return this._client.delete(tX`/conversations/${t}`,e)}}nK.Items=nz;class nX extends tq{create(t,e){let n=!!t.encoding_format,r=n?t.encoding_format:"base64";n&&tf(this._client).debug("embeddings/user defined encoding_format:",t.encoding_format);let s=this._client.post("/embeddings",{body:{...t,encoding_format:r},...e});return n?s:(tf(this._client).debug("embeddings/decoding base64 embeddings from base64"),s._thenUnwrap(t=>(t&&t.data&&t.data.forEach(t=>{let e=t.embedding;t.embedding=nD(e)}),t)))}}class nJ extends tq{retrieve(t,e,n){let{eval_id:r,run_id:s}=e;return this._client.get(tX`/evals/${r}/runs/${s}/output_items/${t}`,n)}list(t,e,n){let{eval_id:r,...s}=e;return this._client.getAPIList(tX`/evals/${r}/runs/${t}/output_items`,tk,{query:s,...n})}}class nV extends tq{constructor(){super(...arguments),this.outputItems=new nJ(this._client)}create(t,e,n){return this._client.post(tX`/evals/${t}/runs`,{body:e,...n})}retrieve(t,e,n){let{eval_id:r}=e;return this._client.get(tX`/evals/${r}/runs/${t}`,n)}list(t,e={},n){return this._client.getAPIList(tX`/evals/${t}/runs`,tk,{query:e,...n})}delete(t,e,n){let{eval_id:r}=e;return this._client.delete(tX`/evals/${r}/runs/${t}`,n)}cancel(t,e,n){let{eval_id:r}=e;return this._client.post(tX`/evals/${r}/runs/${t}`,n)}}nV.OutputItems=nJ;class nY extends tq{constructor(){super(...arguments),this.runs=new nV(this._client)}create(t,e){return this._client.post("/evals",{body:t,...e})}retrieve(t,e){return this._client.get(tX`/evals/${t}`,e)}update(t,e,n){return this._client.post(tX`/evals/${t}`,{body:e,...n})}list(t={},e){return this._client.getAPIList("/evals",tk,{query:t,...e})}delete(t,e){return this._client.delete(tX`/evals/${t}`,e)}}nY.Runs=nV;class nG extends tq{create(t,e){return this._client.post("/files",tR({body:t,...e},this._client))}retrieve(t,e){return this._client.get(tX`/files/${t}`,e)}list(t={},e){return this._client.getAPIList("/files",tk,{query:t,...e})}delete(t,e){return this._client.delete(tX`/files/${t}`,e)}content(t,e){return this._client.get(tX`/files/${t}/content`,{...e,headers:eo([{Accept:"application/binary"},e?.headers]),__binaryResponse:!0})}async waitForProcessing(t,{pollInterval:e=5e3,maxWait:n=18e5}={}){let r=new Set(["processed","error","deleted"]),s=Date.now(),i=await this.retrieve(t);for(;!i.status||!r.has(i.status);)if(await W(e),i=await this.retrieve(t),Date.now()-s>n)throw new m({message:`Giving up on waiting for file ${t} to finish processing after ${n} milliseconds.`});return i}}class nZ extends tq{}class nQ extends tq{run(t,e){return this._client.post("/fine_tuning/alpha/graders/run",{body:t,...e})}validate(t,e){return this._client.post("/fine_tuning/alpha/graders/validate",{body:t,...e})}}class n0 extends tq{constructor(){super(...arguments),this.graders=new nQ(this._client)}}n0.Graders=nQ;class n1 extends tq{create(t,e,n){return this._client.getAPIList(tX`/fine_tuning/checkpoints/${t}/permissions`,tA,{body:e,method:"post",...n})}retrieve(t,e={},n){return this._client.get(tX`/fine_tuning/checkpoints/${t}/permissions`,{query:e,...n})}delete(t,e,n){let{fine_tuned_model_checkpoint:r}=e;return this._client.delete(tX`/fine_tuning/checkpoints/${r}/permissions/${t}`,n)}}class n2 extends tq{constructor(){super(...arguments),this.permissions=new n1(this._client)}}n2.Permissions=n1;class n5 extends tq{list(t,e={},n){return this._client.getAPIList(tX`/fine_tuning/jobs/${t}/checkpoints`,tk,{query:e,...n})}}class n8 extends tq{constructor(){super(...arguments),this.checkpoints=new n5(this._client)}create(t,e){return this._client.post("/fine_tuning/jobs",{body:t,...e})}retrieve(t,e){return this._client.get(tX`/fine_tuning/jobs/${t}`,e)}list(t={},e){return this._client.getAPIList("/fine_tuning/jobs",tk,{query:t,...e})}cancel(t,e){return this._client.post(tX`/fine_tuning/jobs/${t}/cancel`,e)}listEvents(t,e={},n){return this._client.getAPIList(tX`/fine_tuning/jobs/${t}/events`,tk,{query:e,...n})}pause(t,e){return this._client.post(tX`/fine_tuning/jobs/${t}/pause`,e)}resume(t,e){return this._client.post(tX`/fine_tuning/jobs/${t}/resume`,e)}}n8.Checkpoints=n5;class n3 extends tq{constructor(){super(...arguments),this.methods=new nZ(this._client),this.jobs=new n8(this._client),this.checkpoints=new n2(this._client),this.alpha=new n0(this._client)}}n3.Methods=nZ,n3.Jobs=n8,n3.Checkpoints=n2,n3.Alpha=n0;class n6 extends tq{}class n4 extends tq{constructor(){super(...arguments),this.graderModels=new n6(this._client)}}n4.GraderModels=n6;class n7 extends tq{createVariation(t,e){return this._client.post("/images/variations",tR({body:t,...e},this._client))}edit(t,e){return this._client.post("/images/edits",tR({body:t,...e,stream:t.stream??!1},this._client))}generate(t,e){return this._client.post("/images/generations",{body:t,...e,stream:t.stream??!1})}}class n9 extends tq{retrieve(t,e){return this._client.get(tX`/models/${t}`,e)}list(t){return this._client.getAPIList("/models",tA,t)}delete(t,e){return this._client.delete(tX`/models/${t}`,e)}}class rt extends tq{create(t,e){return this._client.post("/moderations",{body:t,...e})}}class re extends tq{accept(t,e,n){return this._client.post(tX`/realtime/calls/${t}/accept`,{body:e,...n,headers:eo([{Accept:"*/*"},n?.headers])})}hangup(t,e){return this._client.post(tX`/realtime/calls/${t}/hangup`,{...e,headers:eo([{Accept:"*/*"},e?.headers])})}refer(t,e,n){return this._client.post(tX`/realtime/calls/${t}/refer`,{body:e,...n,headers:eo([{Accept:"*/*"},n?.headers])})}reject(t,e={},n){return this._client.post(tX`/realtime/calls/${t}/reject`,{body:e,...n,headers:eo([{Accept:"*/*"},n?.headers])})}}class rn extends tq{create(t,e){return this._client.post("/realtime/client_secrets",{body:t,...e})}}class rr extends tq{constructor(){super(...arguments),this.clientSecrets=new rn(this._client),this.calls=new re(this._client)}}function rs(t,e){let n=t.output.map(t=>{if("function_call"===t.type)return{...t,parsed_arguments:function(t,e){var n,r;let s=(n=t.tools??[],r=e.name,n.find(t=>"function"===t.type&&t.name===r));return{...e,...e,parsed_arguments:s?.$brand==="auto-parseable-tool"?s.$parseRaw(e.arguments):s?.strict?JSON.parse(e.arguments):null}}(e,t)};if("message"===t.type){let n=t.content.map(t=>{var n;return"output_text"===t.type?{...t,parsed:(n=t.text,e.text?.format?.type!=="json_schema"?null:"$parseRaw"in e.text?.format?(e.text?.format).$parseRaw(n):JSON.parse(n))}:t});return{...t,content:n}}return t}),r=Object.assign({},t,{output:n});return Object.getOwnPropertyDescriptor(t,"output_text")||ri(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let t of r.output)if("message"===t.type){for(let e of t.content)if("output_text"===e.type&&null!==e.parsed)return e.parsed}return null}}),r}function ri(t){let e=[];for(let n of t.output)if("message"===n.type)for(let t of n.content)"output_text"===t.type&&e.push(t.text);t.output_text=e.join("")}rr.ClientSecrets=rn,rr.Calls=re;class ra extends t5{constructor(t){super(),n_.add(this),nb.set(this,void 0),nv.set(this,void 0),nx.set(this,void 0),o(this,nb,t,"f")}static createResponse(t,e,n){let r=new ra(e);return r._run(()=>r._createOrRetrieveResponse(t,e,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(t,e,n){let r;let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),l(this,n_,"m",nS).call(this);let i=null;for await(let s of("response_id"in e?(r=await t.responses.retrieve(e.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),i=e.starting_after??null):r=await t.responses.create({...e,stream:!0},{...n,signal:this.controller.signal}),this._connected(),r))l(this,n_,"m",nA).call(this,s,i);if(r.controller.signal?.aborted)throw new p;return l(this,n_,"m",nk).call(this)}[(nb=new WeakMap,nv=new WeakMap,nx=new WeakMap,n_=new WeakSet,nS=function(){this.ended||o(this,nv,void 0,"f")},nA=function(t,e){if(this.ended)return;let n=(t,n)=>{(null==e||n.sequence_number>e)&&this._emit(t,n)},r=l(this,n_,"m",nO).call(this,t);switch(n("event",t),t.type){case"response.output_text.delta":{let e=r.output[t.output_index];if(!e)throw new d(`missing output at index ${t.output_index}`);if("message"===e.type){let r=e.content[t.content_index];if(!r)throw new d(`missing content at index ${t.content_index}`);if("output_text"!==r.type)throw new d(`expected content to be 'output_text', got ${r.type}`);n("response.output_text.delta",{...t,snapshot:r.text})}break}case"response.function_call_arguments.delta":{let e=r.output[t.output_index];if(!e)throw new d(`missing output at index ${t.output_index}`);"function_call"===e.type&&n("response.function_call_arguments.delta",{...t,snapshot:e.arguments});break}default:n(t.type,t)}},nk=function(){if(this.ended)throw new d("stream has ended, this shouldn't happen");let t=l(this,nv,"f");if(!t)throw new d("request ended without sending any events");o(this,nv,void 0,"f");let e=function(t,e){return e&&tY(e.text?.format)?rs(t,e):{...t,output_parsed:null,output:t.output.map(t=>"function_call"===t.type?{...t,parsed_arguments:null}:"message"===t.type?{...t,content:t.content.map(t=>({...t,parsed:null}))}:t)}}(t,l(this,nb,"f"));return o(this,nx,e,"f"),e},nO=function(t){let e=l(this,nv,"f");if(!e){if("response.created"!==t.type)throw new d(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return o(this,nv,t.response,"f")}switch(t.type){case"response.output_item.added":e.output.push(t.item);break;case"response.content_part.added":{let n=e.output[t.output_index];if(!n)throw new d(`missing output at index ${t.output_index}`);let r=n.type,s=t.part;"message"===r&&"reasoning_text"!==s.type?n.content.push(s):"reasoning"===r&&"reasoning_text"===s.type&&(n.content||(n.content=[]),n.content.push(s));break}case"response.output_text.delta":{let n=e.output[t.output_index];if(!n)throw new d(`missing output at index ${t.output_index}`);if("message"===n.type){let e=n.content[t.content_index];if(!e)throw new d(`missing content at index ${t.content_index}`);if("output_text"!==e.type)throw new d(`expected content to be 'output_text', got ${e.type}`);e.text+=t.delta}break}case"response.function_call_arguments.delta":{let n=e.output[t.output_index];if(!n)throw new d(`missing output at index ${t.output_index}`);"function_call"===n.type&&(n.arguments+=t.delta);break}case"response.reasoning_text.delta":{let n=e.output[t.output_index];if(!n)throw new d(`missing output at index ${t.output_index}`);if("reasoning"===n.type){let e=n.content?.[t.content_index];if(!e)throw new d(`missing content at index ${t.content_index}`);if("reasoning_text"!==e.type)throw new d(`expected content to be 'reasoning_text', got ${e.type}`);e.text+=t.delta}break}case"response.completed":o(this,nv,t.response,"f")}return e},Symbol.asyncIterator)](){let t=[],e=[],n=!1;return this.on("event",n=>{let r=e.shift();r?r.resolve(n):t.push(n)}),this.on("end",()=>{for(let t of(n=!0,e))t.resolve(void 0);e.length=0}),this.on("abort",t=>{for(let r of(n=!0,e))r.reject(t);e.length=0}),this.on("error",t=>{for(let r of(n=!0,e))r.reject(t);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((t,n)=>e.push({resolve:t,reject:n})).then(t=>t?{value:t,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let t=l(this,nx,"f");if(!t)throw new d("stream ended without producing a ChatCompletion");return t}}class ro extends tq{list(t,e={},n){return this._client.getAPIList(tX`/responses/${t}/input_items`,tk,{query:e,...n})}}class rl extends tq{count(t={},e){return this._client.post("/responses/input_tokens",{body:t,...e})}}class rh extends tq{constructor(){super(...arguments),this.inputItems=new ro(this._client),this.inputTokens=new rl(this._client)}create(t,e){return this._client.post("/responses",{body:t,...e,stream:t.stream??!1})._thenUnwrap(t=>("object"in t&&"response"===t.object&&ri(t),t))}retrieve(t,e={},n){return this._client.get(tX`/responses/${t}`,{query:e,...n,stream:e?.stream??!1})._thenUnwrap(t=>("object"in t&&"response"===t.object&&ri(t),t))}delete(t,e){return this._client.delete(tX`/responses/${t}`,{...e,headers:eo([{Accept:"*/*"},e?.headers])})}parse(t,e){return this._client.responses.create(t,e)._thenUnwrap(e=>rs(e,t))}stream(t,e){return ra.createResponse(this._client,t,e)}cancel(t,e){return this._client.post(tX`/responses/${t}/cancel`,e)}compact(t,e){return this._client.post("/responses/compact",{body:t,...e})}}rh.InputItems=ro,rh.InputTokens=rl;class rc extends tq{create(t,e,n){return this._client.post(tX`/uploads/${t}/parts`,tR({body:e,...n},this._client))}}class ru extends tq{constructor(){super(...arguments),this.parts=new rc(this._client)}create(t,e){return this._client.post("/uploads",{body:t,...e})}cancel(t,e){return this._client.post(tX`/uploads/${t}/cancel`,e)}complete(t,e,n){return this._client.post(tX`/uploads/${t}/complete`,{body:e,...n})}}ru.Parts=rc;let rd=async t=>{let e=await Promise.allSettled(t),n=e.filter(t=>"rejected"===t.status);if(n.length){for(let t of n)console.error(t.reason);throw Error(`${n.length} promise(s) failed - see the above errors`)}let r=[];for(let t of e)"fulfilled"===t.status&&r.push(t.value);return r};class rf extends tq{create(t,e,n){return this._client.post(tX`/vector_stores/${t}/file_batches`,{body:e,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(t,e,n){let{vector_store_id:r}=e;return this._client.get(tX`/vector_stores/${r}/file_batches/${t}`,{...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(t,e,n){let{vector_store_id:r}=e;return this._client.post(tX`/vector_stores/${r}/file_batches/${t}/cancel`,{...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(t,e,n){let r=await this.create(t,e);return await this.poll(t,r.id,n)}listFiles(t,e,n){let{vector_store_id:r,...s}=e;return this._client.getAPIList(tX`/vector_stores/${r}/file_batches/${t}/files`,tk,{query:s,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(t,e,n){let r=eo([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:s,response:i}=await this.retrieve(e,{vector_store_id:t},{...n,headers:r}).withResponse();switch(s.status){case"in_progress":let a=5e3;if(n?.pollIntervalMs)a=n.pollIntervalMs;else{let t=i.headers.get("openai-poll-after-ms");if(t){let e=parseInt(t);isNaN(e)||(a=e)}}await W(a);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(t,{files:e,fileIds:n=[]},r){if(null==e||0==e.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let s=Math.min(r?.maxConcurrency??5,e.length),i=this._client,a=e.values(),o=[...n];async function l(t){for(let e of t){let t=await i.files.create({file:e,purpose:"assistants"},r);o.push(t.id)}}let h=Array(s).fill(a).map(l);return await rd(h),await this.createAndPoll(t,{file_ids:o})}}class rp extends tq{create(t,e,n){return this._client.post(tX`/vector_stores/${t}/files`,{body:e,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(t,e,n){let{vector_store_id:r}=e;return this._client.get(tX`/vector_stores/${r}/files/${t}`,{...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(t,e,n){let{vector_store_id:r,...s}=e;return this._client.post(tX`/vector_stores/${r}/files/${t}`,{body:s,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t,e={},n){return this._client.getAPIList(tX`/vector_stores/${t}/files`,tk,{query:e,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(t,e,n){let{vector_store_id:r}=e;return this._client.delete(tX`/vector_stores/${r}/files/${t}`,{...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(t,e,n){let r=await this.create(t,e,n);return await this.poll(t,r.id,n)}async poll(t,e,n){let r=eo([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let s=await this.retrieve(e,{vector_store_id:t},{...n,headers:r}).withResponse(),i=s.data;switch(i.status){case"in_progress":let a=5e3;if(n?.pollIntervalMs)a=n.pollIntervalMs;else{let t=s.response.headers.get("openai-poll-after-ms");if(t){let e=parseInt(t);isNaN(e)||(a=e)}}await W(a);break;case"failed":case"completed":return i}}}async upload(t,e,n){let r=await this._client.files.create({file:e,purpose:"assistants"},n);return this.create(t,{file_id:r.id},n)}async uploadAndPoll(t,e,n){let r=await this.upload(t,e,n);return await this.poll(t,r.id,n)}content(t,e,n){let{vector_store_id:r}=e;return this._client.getAPIList(tX`/vector_stores/${r}/files/${t}/content`,tA,{...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class rg extends tq{constructor(){super(...arguments),this.files=new rp(this._client),this.fileBatches=new rf(this._client)}create(t,e){return this._client.post("/vector_stores",{body:t,...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}retrieve(t,e){return this._client.get(tX`/vector_stores/${t}`,{...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}update(t,e,n){return this._client.post(tX`/vector_stores/${t}`,{body:e,...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t={},e){return this._client.getAPIList("/vector_stores",tk,{query:t,...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}delete(t,e){return this._client.delete(tX`/vector_stores/${t}`,{...e,headers:eo([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}search(t,e,n){return this._client.getAPIList(tX`/vector_stores/${t}/search`,tA,{body:e,method:"post",...n,headers:eo([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}rg.Files=rp,rg.FileBatches=rf;class rm extends tq{create(t,e){return this._client.post("/videos",t$({body:t,...e},this._client))}retrieve(t,e){return this._client.get(tX`/videos/${t}`,e)}list(t={},e){return this._client.getAPIList("/videos",tO,{query:t,...e})}delete(t,e){return this._client.delete(tX`/videos/${t}`,e)}downloadContent(t,e={},n){return this._client.get(tX`/videos/${t}/content`,{query:e,...n,headers:eo([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}remix(t,e,n){return this._client.post(tX`/videos/${t}/remix`,t$({body:e,...n},this._client))}}var ry=n(96434).Buffer;class rw extends tq{constructor(){super(...arguments),nE.add(this)}async unwrap(t,e,n=this._client.webhookSecret,r=300){return await this.verifySignature(t,e,n,r),JSON.parse(t)}async verifySignature(t,e,n=this._client.webhookSecret,r=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");l(this,nE,"m",nC).call(this,n);let s=eo([e]).values,i=l(this,nE,"m",nP).call(this,s,"webhook-signature"),a=l(this,nE,"m",nP).call(this,s,"webhook-timestamp"),o=l(this,nE,"m",nP).call(this,s,"webhook-id"),h=parseInt(a,10);if(isNaN(h))throw new E("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-h>r)throw new E("Webhook timestamp is too old");if(h>c+r)throw new E("Webhook timestamp is too new");let u=i.split(" ").map(t=>t.startsWith("v1,")?t.substring(3):t),d=n.startsWith("whsec_")?ry.from(n.replace("whsec_",""),"base64"):ry.from(n,"utf-8"),f=o?`${o}.${a}.${t}`:`${a}.${t}`,p=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let t of u)try{let e=ry.from(t,"base64");if(await crypto.subtle.verify("HMAC",p,e,new TextEncoder().encode(f)))return}catch{continue}throw new E("The given webhook signature does not match the expected signature")}}nE=new WeakSet,nC=function(t){if("string"!=typeof t||0===t.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},nP=function(t,e){if(!t)throw Error("Headers are required");let n=t.get(e);if(null==n)throw Error(`Missing required header: ${e}`);return n};class r_{constructor({baseURL:t=nW("OPENAI_BASE_URL"),apiKey:e=nW("OPENAI_API_KEY"),organization:n=nW("OPENAI_ORG_ID")??null,project:r=nW("OPENAI_PROJECT_ID")??null,webhookSecret:s=nW("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(nI.add(this),nR.set(this,void 0),this.completions=new nj(this),this.chat=new ei(this),this.embeddings=new nX(this),this.files=new nG(this),this.images=new n7(this),this.audio=new eu(this),this.moderations=new rt(this),this.models=new n9(this),this.fineTuning=new n3(this),this.graders=new n4(this),this.vectorStores=new rg(this),this.webhooks=new rw(this),this.beta=new nF(this),this.batches=new ed(this),this.uploads=new ru(this),this.responses=new rh(this),this.realtime=new rr(this),this.conversations=new nK(this),this.evals=new nY(this),this.containers=new nq(this),this.videos=new rm(this),void 0===e)throw new d("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let a={apiKey:e,organization:n,project:r,webhookSecret:s,...i,baseURL:t||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&U())throw new d("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??n$.DEFAULT_TIMEOUT,this.logger=a.logger??console;let l="warn";this.logLevel=l,this.logLevel=tl(a.logLevel,"ClientOptions.logLevel",this)??tl(nW("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??l,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),o(this,nR,X,"f"),this._options=a,this.apiKey="string"==typeof e?e:"Missing Key",this.organization=n,this.project=r,this.webhookSecret=s}withOptions(t){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...t})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:e}){}async authHeaders(t){return eo([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(t){return function(t,e={}){let n,r=t,s=function(t=tn){let e;if(void 0!==t.allowEmptyArrays&&"boolean"!=typeof t.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==t.encodeDotInKeys&&"boolean"!=typeof t.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw TypeError("Encoder has to be a function.");let n=t.charset||tn.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=J;if(void 0!==t.format){if(!G(Y,t.format))throw TypeError("Unknown format option provided.");r=t.format}let s=Y[r],i=tn.filter;if(("function"==typeof t.filter||I(t.filter))&&(i=t.filter),e=t.arrayFormat&&t.arrayFormat in tt?t.arrayFormat:"indices"in t?t.indices?"indices":"repeat":tn.arrayFormat,"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===t.allowDots?!0==!!t.encodeDotInKeys||tn.allowDots:!!t.allowDots;return{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:tn.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof t.allowEmptyArrays?!!t.allowEmptyArrays:tn.allowEmptyArrays,arrayFormat:e,charset:n,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:tn.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:void 0===t.delimiter?tn.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:tn.encode,encodeDotInKeys:"boolean"==typeof t.encodeDotInKeys?t.encodeDotInKeys:tn.encodeDotInKeys,encoder:"function"==typeof t.encoder?t.encoder:tn.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:tn.encodeValuesOnly,filter:i,format:r,formatter:s,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:tn.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:tn.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:tn.strictNullHandling}}(e);"function"==typeof s.filter?r=(0,s.filter)("",r):I(s.filter)&&(n=s.filter);let i=[];if("object"!=typeof r||null===r)return"";let a=tt[s.arrayFormat],o="comma"===a&&s.commaRoundTrip;n||(n=Object.keys(r)),s.sort&&n.sort(s.sort);let l=new WeakMap;for(let t=0;t<n.length;++t){let e=n[t];s.skipNulls&&null===r[e]||te(i,function t(e,n,r,s,i,a,o,l,h,c,u,d,f,p,g,m,y,w){var _,b;let v,x=e,S=w,A=0,k=!1;for(;void 0!==(S=S.get(tr))&&!k;){let t=S.get(e);if(A+=1,void 0!==t){if(t===A)throw RangeError("Cyclic object value");k=!0}void 0===S.get(tr)&&(A=0)}if("function"==typeof c?x=c(n,x):x instanceof Date?x=f?.(x):"comma"===r&&I(x)&&(x=Q(x,function(t){return t instanceof Date?f?.(t):t})),null===x){if(a)return h&&!m?h(n,tn.encoder,y,"key",p):n;x=""}if("string"==typeof(_=x)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(h){let t=m?n:h(n,tn.encoder,y,"key",p);return[g?.(t)+"="+g?.(h(x,tn.encoder,y,"value",p))]}return[g?.(n)+"="+g?.(String(x))]}let O=[];if(void 0===x)return O;if("comma"===r&&I(x))m&&h&&(x=Q(x,h)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(I(c))v=c;else{let t=Object.keys(x);v=u?t.sort(u):t}let E=l?String(n).replace(/\./g,"%2E"):String(n),C=s&&I(x)&&1===x.length?E+"[]":E;if(i&&I(x)&&0===x.length)return C+"[]";for(let n=0;n<v.length;++n){let _=v[n],b="object"==typeof _&&void 0!==_.value?_.value:x[_];if(o&&null===b)continue;let S=d&&l?_.replace(/\./g,"%2E"):_,k=I(x)?"function"==typeof r?r(C,S):C:C+(d?"."+S:"["+S+"]");w.set(e,A);let E=new WeakMap;E.set(tr,w),te(O,t(b,k,r,s,i,a,o,l,"comma"===r&&m&&I(x)?null:h,c,u,d,f,p,g,m,y,E))}return O}(r[e],e,a,o,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,l))}let h=i.join(s.delimiter),c=!0===s.addQueryPrefix?"?":"";return s.charsetSentinel&&("iso-8859-1"===s.charset?c+="utf8=%26%2310003%3B&":c+="utf8=%E2%9C%93&"),h.length>0?c+h:""}(t,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${M}`}defaultIdempotencyKey(){return`stainless-node-retry-${h()}`}makeStatusError(t,e,n,r){return f.generate(t,e,n,r)}async _callApiKey(){let t;let e=this._options.apiKey;if("function"!=typeof e)return!1;try{t=await e()}catch(t){if(t instanceof d)throw t;throw new d(`Failed to get token from 'apiKey' function: ${t.message}`,{cause:t})}if("string"!=typeof t||!t)throw new d(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(t,e,n){let r=!l(this,nI,"m",nT).call(this)&&n||this.baseURL,s=new URL(P(t)?t:r+(r.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),i=this.defaultQuery();return!function(t){if(!t)return!0;for(let e in t)return!1;return!0}(i)&&(e={...i,...e}),"object"==typeof e&&e&&!Array.isArray(e)&&(s.search=this.stringifyQuery(e)),s.toString()}async prepareOptions(t){await this._callApiKey()}async prepareRequest(t,{url:e,options:n}){}get(t,e){return this.methodRequest("get",t,e)}post(t,e){return this.methodRequest("post",t,e)}patch(t,e){return this.methodRequest("patch",t,e)}put(t,e){return this.methodRequest("put",t,e)}delete(t,e){return this.methodRequest("delete",t,e)}methodRequest(t,e,n){return this.request(Promise.resolve(n).then(n=>({method:t,path:e,...n})))}request(t,e=null){return new tv(this,this.makeRequest(t,e,void 0))}async makeRequest(t,e,n){let r=await t,s=r.maxRetries??this.maxRetries;null==e&&(e=s),await this.prepareOptions(r);let{req:i,url:a,timeout:o}=await this.buildRequest(r,{retryCount:s-e});await this.prepareRequest(i,{url:a,options:r});let l="log_"+(16777216*Math.random()|0).toString(16).padStart(6,"0"),h=void 0===n?"":`, retryOf: ${n}`,d=Date.now();if(tf(this).debug(`[${l}] sending request`,tp({retryOfRequestLogID:n,method:r.method,url:a,options:r,headers:i.headers})),r.signal?.aborted)throw new p;let f=new AbortController,y=await this.fetchWithTimeout(a,i,o,f).catch(u),w=Date.now();if(y instanceof globalThis.Error){let t=`retrying, ${e} attempts remaining`;if(r.signal?.aborted)throw new p;let s=c(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(e)return tf(this).info(`[${l}] connection ${s?"timed out":"failed"} - ${t}`),tf(this).debug(`[${l}] connection ${s?"timed out":"failed"} (${t})`,tp({retryOfRequestLogID:n,url:a,durationMs:w-d,message:y.message})),this.retryRequest(r,e,n??l);if(tf(this).info(`[${l}] connection ${s?"timed out":"failed"} - error; no more retries left`),tf(this).debug(`[${l}] connection ${s?"timed out":"failed"} (error; no more retries left)`,tp({retryOfRequestLogID:n,url:a,durationMs:w-d,message:y.message})),s)throw new m;throw new g({cause:y})}let _=[...y.headers.entries()].filter(([t])=>"x-request-id"===t).map(([t,e])=>", "+t+": "+JSON.stringify(e)).join(""),b=`[${l}${h}${_}] ${i.method} ${a} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${w-d}ms`;if(!y.ok){let t=await this.shouldRetry(y);if(e&&t){let t=`retrying, ${e} attempts remaining`;return await K(y.body),tf(this).info(`${b} - ${t}`),tf(this).debug(`[${l}] response error (${t})`,tp({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,durationMs:w-d})),this.retryRequest(r,e,n??l,y.headers)}let s=t?"error; no more retries left":"error; not retryable";tf(this).info(`${b} - ${s}`);let i=await y.text().catch(t=>u(t).message),a=D(i),o=a?void 0:i;throw tf(this).debug(`[${l}] response error (${s})`,tp({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,message:o,durationMs:Date.now()-d})),this.makeStatusError(y.status,a,o,y.headers)}return tf(this).info(b),tf(this).debug(`[${l}] response start`,tp({retryOfRequestLogID:n,url:y.url,status:y.status,headers:y.headers,durationMs:w-d})),{response:y,options:r,controller:f,requestLogID:l,retryOfRequestLogID:n,startTime:d}}getAPIList(t,e,n){return this.requestAPIList(e,{method:"get",path:t,...n})}requestAPIList(t,e){return new tS(this,this.makeRequest(e,null,void 0),t)}async fetchWithTimeout(t,e,n,r){let{signal:s,method:i,...a}=e||{};s&&s.addEventListener("abort",()=>r.abort());let o=setTimeout(()=>r.abort(),n),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,h={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(h.method=i.toUpperCase());try{return await this.fetch.call(void 0,t,h)}finally{clearTimeout(o)}}async shouldRetry(t){let e=t.headers.get("x-should-retry");return"true"===e||"false"!==e&&(408===t.status||409===t.status||429===t.status||t.status>=500)}async retryRequest(t,e,n,r){let s;let i=r?.get("retry-after-ms");if(i){let t=parseFloat(i);Number.isNaN(t)||(s=t)}let a=r?.get("retry-after");if(a&&!s){let t=parseFloat(a);s=Number.isNaN(t)?Date.parse(a)-Date.now():1e3*t}if(!(s&&0<=s&&s<6e4)){let n=t.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(e,n)}return await W(s),this.makeRequest(t,e-1,n)}calculateDefaultRetryTimeoutMillis(t,e){return Math.min(.5*Math.pow(2,e-t),8)*(1-.25*Math.random())*1e3}async buildRequest(t,{retryCount:e=0}={}){let n={...t},{method:r,path:s,query:i,defaultBaseURL:a}=n,o=this.buildURL(s,i,a);"timeout"in n&&N("timeout",n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:l,body:h}=this.buildBody({options:n}),c=await this.buildHeaders({options:t,method:r,bodyHeaders:l,retryCount:e});return{req:{method:r,headers:c,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&h instanceof globalThis.ReadableStream&&{duplex:"half"},...h&&{body:h},...this.fetchOptions??{},...n.fetchOptions??{}},url:o,timeout:n.timeout}}async buildHeaders({options:t,method:e,bodyHeaders:n,retryCount:r}){let s={};this.idempotencyHeader&&"get"!==e&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=t.idempotencyKey);let i=eo([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{},...B(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(t),this._options.defaultHeaders,n,t.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:t,headers:e}}){if(!t)return{bodyHeaders:void 0,body:void 0};let n=eo([e]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||"string"==typeof t&&n.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:"object"==typeof t&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&"function"==typeof t.next)?{bodyHeaders:void 0,body:q(t)}:l(this,nR,"f").call(this,{body:t,headers:n})}}n$=r_,nR=new WeakMap,nI=new WeakSet,nT=function(){return"https://api.openai.com/v1"!==this.baseURL},r_.OpenAI=n$,r_.DEFAULT_TIMEOUT=6e5,r_.OpenAIError=d,r_.APIError=f,r_.APIConnectionError=g,r_.APIConnectionTimeoutError=m,r_.APIUserAbortError=p,r_.NotFoundError=b,r_.ConflictError=v,r_.RateLimitError=S,r_.BadRequestError=y,r_.AuthenticationError=w,r_.InternalServerError=A,r_.PermissionDeniedError=_,r_.UnprocessableEntityError=x,r_.InvalidWebhookSignatureError=E,r_.toFile=tB,r_.Completions=nj,r_.Chat=ei,r_.Embeddings=nX,r_.Files=nG,r_.Images=n7,r_.Audio=eu,r_.Moderations=rt,r_.Models=n9,r_.FineTuning=n3,r_.Graders=n4,r_.VectorStores=rg,r_.Webhooks=rw,r_.Beta=nF,r_.Batches=ed,r_.Uploads=ru,r_.Responses=rh,r_.Realtime=rr,r_.Conversations=nK,r_.Evals=nY,r_.Containers=nq,r_.Videos=rm,n(40257)}}]);